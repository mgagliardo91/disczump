{"filter":false,"title":"oauthRouter.js","tooltip":"/app/oauthRouter.js","undoManager":{"mark":29,"position":29,"stack":[[{"group":"doc","deltas":[{"start":{"row":3,"column":7},"end":{"row":3,"column":10},"action":"remove","lines":["api"]},{"start":{"row":3,"column":7},"end":{"row":3,"column":8},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":8},"end":{"row":3,"column":9},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":9},"end":{"row":3,"column":10},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":10},"end":{"row":3,"column":11},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":11},"end":{"row":3,"column":12},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":12},"end":{"row":3,"column":13},"action":"insert","lines":["R"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":13},"end":{"row":3,"column":14},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":14},"end":{"row":3,"column":15},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":15},"end":{"row":3,"column":16},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":16},"end":{"row":3,"column":17},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":17},"end":{"row":3,"column":18},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":1,"column":35},"action":"remove","lines":["var DiscController = require('./controllers/disc');","var passport = require('passport');"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":0},"end":{"row":69,"column":23},"action":"remove","lines":["    app.route('/discs')","    ","        .post(passport.authenticate('api-login', { session : false }), function(req, res) {","            DiscController.postDisc(req.user._id, req.body, function(err, disc) {","                if (err)","                  return res.send(err);","            ","                return res.json(disc);","              });","        })","    ","        .get(hasAccess, function(req, res) {","            DiscController.getDiscs(req.user._id, function(err, discs) {","                if (err)","                  return res.send(err);","            ","                return res.json(discs);","              });","        });","        ","    app.route('/discs/:discId')","    ","        .get(passport.authenticate('api-login', { session : false }), function(req, res) {","            DiscController.getDisc(req.user._id, req.params.discId, function(err, disc) {","                if (err)","                  return res.send(err);","            ","                return res.json(disc);","              });","        })","        ","        .put(passport.authenticate('api-login', { session : false }), function(req, res) {","            DiscController.putDisc(req.user._id, req.params.discId, req.body, function(err, disc) {","                if (err)","                  return res.send(err);","            ","                return res.json(disc);","              });","        })","        ","        .delete(passport.authenticate('api-login', { session : false }), function(req, res) {","            DiscController.deleteDisc(req.user._id, req.params.discId, function(err, disc) {","                if (err)","                  return res.send(err);","            ","                return res.json(disc);","              });","        });","    ","    app.get('/', function(req, res){","       res.send('Hello'); ","    });","}","","function hasAccess(req, res, next) {","    ","    if (req.isAuthenticated()) return next();","    passport.authenticate('bearer', { session : false }, function(err, user, info) {","        if (err) { return next(err); }","        if (!user) { ","            return res.send(401, 'Unathorized');","        }","        req.user = user;","        next();","    })(req, res, next);"]},{"start":{"row":5,"column":0},"end":{"row":5,"column":1},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":1},"end":{"row":5,"column":2},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":2},"end":{"row":5,"column":3},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":2},"end":{"row":5,"column":3},"action":"remove","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":1},"end":{"row":5,"column":2},"action":"remove","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":0},"end":{"row":5,"column":1},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":0},"end":{"row":5,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":4},"end":{"row":5,"column":5},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":5},"end":{"row":5,"column":6},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":6},"end":{"row":5,"column":7},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":7},"end":{"row":5,"column":8},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":8},"end":{"row":5,"column":9},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":9},"end":{"row":5,"column":10},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":10},"end":{"row":5,"column":11},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":11},"end":{"row":5,"column":12},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":8},"end":{"row":5,"column":12},"action":"remove","lines":["post"]},{"start":{"row":5,"column":8},"end":{"row":5,"column":43},"action":"insert","lines":["post('/oauth/token', oauth2.token);"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":15},"end":{"row":5,"column":20},"action":"remove","lines":["oauth"]}]}],[{"group":"doc","deltas":[{"start":{"row":5,"column":14},"end":{"row":5,"column":15},"action":"remove","lines":["/"]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":6,"column":1},"end":{"row":6,"column":1},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1418844768345,"hash":"eefa5280ef89703441a2131c14080b1ef973bd8f"}