angular.module("disczump.controllers",["disczump.services"]).filter("startFrom",[function(){return function(e,t){return e?(t=+t,e.slice(t)):[]}}]).filter("cc",function(){return function(e){for(var t="",i=0;i<e.length;i++)i>0&&i%4==0&&(t+=" "),t+=e[i];return t}}).filter("exp",function(){return function(e){return 4==e.length?e.substr(0,2)+"/"+e.substr(2,2):e}}).filter("memType",["MembershipService",function(e){return function(t){return e.getAccountName(t)}}]).filter("memCost",["MembershipService",function(e){return function(t){return e.getAccountCost(t)}}]).directive("dzMaxLength",function(){return{require:"ngModel",link:function(e,t,i,a){function n(e){if(e.length>s){var t=e.substring(0,s);return a.$setViewValue(t),a.$render(),t}return e}var s=parseInt(i.dzMaxLength);a.$parsers.push(n)}}}).directive("fadeTime",["$window","$timeout","$parse","PageUtils",function(e,t,i,a){return{restrict:"A",scope:!1,link:function(i,n,s){var o=Math.max(0,parseInt(s.fadeTime)),r=!1,c=a.getTransitionEndEventName();n.addClass("fade-time"),s.fadeReverse&&n.addClass("fade-reverse");var l=function(){s.fadeReverse&&n.css("display","none"),s.fadeComplete&&t(function(){i.fadeComplete=!0})},d=function(){r||(r=!0,n.addClass("expired"),c||t(l,750))},u=function(){t(d,o)},p=function(){a.getScrollPos()+a.getWindowHeight()>=a.getTop(n[0])&&(angular.element(e).unbind("scroll",p),u())};s.fadeOverride&&i.$watch(s.fadeOverride,function(e){"undefined"!=typeof e&&e&&d()}),c&&n[0].addEventListener(c,l,!1),i.$on("$destroy",function(){s.fadeScroll&&angular.element(e).unbind("scroll",p)}),s.fadeStart?i.$watch(s.fadeStart,function(e){"undefined"!=typeof e&&e&&u()}):s.fadeScroll?angular.element(e).bind("scroll",p):u()}}}]).directive("parallax",["$window","PageUtils",function(e,t){return{restrict:"A",transclude:!0,template:"<div ng-transclude></div>",scope:{parallaxRatio:"@",parallaxVerticalOffset:"@"},link:function(i,a,n){var s=function(){var n=(t.getTop(a[0])-e.pageYOffset)*(i.parallaxRatio?i.parallaxRatio:1.1)-(i.parallaxVerticalOffset||0);a.css("background-position","50% "+n+"px")},o=function(){s(),i.$apply()};angular.element(e).bind("load",o),angular.element(e).bind("scroll",s),angular.element(e).bind("touchmove",s),i.$on("$destroy",function(){angular.element(e).unbind("load",o),angular.element(e).unbind("scroll",s),angular.element(e).unbind("touchmove",s)})}}}]).directive("filterDropdown",["$window","$compile","$location","AccountService","PageUtils",function($window,$compile,$location,AccountService,PageUtils){return{restrict:"A",link:function(scope,element,attrs){var opts,dropdown,backdrop,buffer=5,relocateDropdown=function(){dropdown&&dropdown.css({top:PageUtils.getFullHeight(element[0])+buffer+"px",left:PageUtils.getLeft(element[0])+"px"})},hideFilter=function(e){if(backdrop){if(e){if(e.target!=backdrop[0])return;e.stopPropagation()}backdrop[0].parentNode.removeChild(backdrop[0]),backdrop=void 0,dropdown=void 0,angular.element($window).unbind("resize",relocateDropdown)}};scope.hideFilter=function(e){hideFilter(e)},scope.doFilter=function(e){var t=opts.prop+":"+opts.val;hideFilter(),e?$location.url("/explore?s=rel&f_0="+t):$location.url("/t/"+AccountService.getAccount().username+"?s=rel&f_0="+t)};var handleClick=function(){backdrop=angular.element('<div class="full-backdrop" ng-click="hideFilter($event)"></div>'),dropdown=angular.element('<div class="filter-dropdown"><div class="filter-marker"></div><div class="filter-dd-title">'+(opts.text?opts.text:opts.prop)+": "+opts.val+(opts.suffix?opts.suffix:"")+'</div><div class="filter-dd-opt"><span class="hover-underline" ng-click="doFilter(true);"><span><i class="fa fa-filter"></i></span>Filter globally</span></div>'+(AccountService.isLoggedIn()?'<div class="filter-dd-opt hover-underline"><span class="hover-underline" ng-click="doFilter();"><span><i class="fa fa-filter"></i></span>Filter in my trunk</span></div>':"")+"</div>"),document.body.appendChild(backdrop[0]),backdrop[0].appendChild(dropdown[0]),$compile(backdrop)(scope),relocateDropdown(),angular.element($window).bind("resize",relocateDropdown)};try{opts=eval("("+attrs.filterDropdown+")")}catch(e){return void console.log("Invalid expression for filter dropdown.")}opts.prop&&opts.val&&(element.bind("click",handleClick),scope.$on("destroy",function(){element.unbind("click",handleClick),hideFilter()}))}}}]).directive("dynIframe",[function(){return{restrict:"E",scope:{config:"="},link:function(e,t){function i(){var i="<iframe ";for(var a in e.config.params)i+=a+'="'+e.config.params[a]+'" ';i+="></iframe>";var n=angular.element(i);t[0].appendChild(n[0])}e.$watch("config.create",function(e){e===!0&&i()})}}}]).directive("removeIf",[function(){return{restrict:"A",scope:{removeIf:"="},link:function(e,t){e.$watch("removeIf",function(e){"undefined"!=typeof e&&e&&t.remove()})}}}]).directive("countdown",["$interval","$timeout",function(e,t){return{restrict:"A",scope:{secLeft:"=",counts:"=",done:"=",show:"="},link:function(i,a){var n,s=function(){void 0!==typeof i.secLeft&&(i.secLeft>0?(i.done=!1,i.counts={hours:("0"+parseInt(i.secLeft/3600)).slice(-3),minutes:("0"+parseInt(i.secLeft%3600/60)).slice(-2),seconds:("0"+parseInt(i.secLeft%3600%60%60)).slice(-2)},i.secLeft=i.secLeft-1):i.done=!0)};i.$watch("done",function(t){"undefined"!=typeof t&&(t?e.cancel(n):n=e(s,1e3))}),t(function(){i.show=!0},1e3),a.on("$destroy",function(){e.cancel(n)}),s()}}}]).directive("matchWidth",[function(){return{restrict:"A",link:function(e,t,i){var a=function(e){angular.element(t[0]).css({height:e+"px"})};e.$watch(function(){return t[0].offsetWidth},function(e){a(e)})}}}]).directive("overflowWrapper",[function(){return{restrict:"E",replace:!0,template:"<div ng-transclude></div>",transclude:!0,link:function(e,t,i){var a=function(e){var i=angular.element(t[0].children[0]);i.css({maxWidth:e+"px"})};e.$watch(function(){return t[0].clientWidth},function(e){a(e)})}}}]).directive("mustMatch",[function(){return{require:"ngModel",scope:{ov:"=mustMatch"},link:function(e,t,i,a){a.$validators.compareTo=function(t){return t==e.ov},e.$watch("ov",function(){a.$validate()})}}}]).directive("patternSet",function(){return{require:"ngModel",link:function(e,t,i,a){var n=new RegExp(i.patternSet);a.$parsers.unshift(function(e){return a.$setValidity("patternSet",n.test(e)),e&&e.length?e:void 0}),a.$formatters.unshift(function(e){return a.$setValidity("patternSet",n.test(e)),e&&e.length?e:void 0})}}}).directive("validIf",["$parse",function(e){return{require:"ngModel",link:function(t,i,a,n){t.$watch(function(){return e(a.validIf)(t.$parent)},function(e){n.$setValidity("validIf",e&&e.length)})}}}]).directive("focusOn",["$timeout",function(e){return{restrict:"A",scope:{trigger:"=focusOn"},link:function(t,i){t.$watch("trigger",function(t){t===!0&&e(function(){i[0].focus()},300)})}}}]).directive("keyScrollList",["$timeout",function(e){return{restrict:"A",scope:{keyScrollList:"=",selection:"=",onSelect:"=",triggerFocus:"="},link:function(t,i){var a=function(i){switch(i.keyCode){case 9:t.selection>-1&&e(function(){t.onSelect(t.selection)});break;case 13:e(function(){t.selection>-1&&t.onSelect(t.selection)});break;case 38:e(function(){t.selection=Math.max(-1,t.selection-1)});break;case 40:e(function(){t.selection=Math.min(t.keyScrollList.length-1,t.selection+1)})}};i.bind("keydown",a),t.$watch("triggerFocus",function(t){t===!0&&e(function(){i[0].focus()},300)}),t.$on("$destroy",function(){i.unbind("keyup",a)})}}}]).directive("scrollMe",["$timeout",function(e){return{restrict:"A",scope:{scrollMe:"="},link:function(e,t){var i=t[0].parentElement;e.$watch("scrollMe",function(e){if("undefined"!=typeof e&&e===!0){var a=t[0].offsetTop+t[0].offsetHeight,n=i.scrollTop+i.offsetHeight;i.scrollTop>t[0].offsetTop?i.scrollTop=t[0].offsetTop:n<a&&(i.scrollTop=a-i.offsetHeight)}})}}}]).directive("parseInput",["$compile",function(e){return{restrict:"A",require:"ngModel",link:function(e,t,i,a){t.on("paste",function(){console.log("pasted")})}}}]).directive("locationSearch",["$window","$compile","$timeout","LocationService",function(e,t,i,a){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",locationSearch:"="},link:function(e,n,s,o){e.results=[],e.active=!1,e.init=!1,e.activeIndex=-1;var r,c,l=function(){r.css("width",n[0].clientWidth+"px")},d=function(t,i){a.getReverseGeo(t,i,function(t,i){t&&i.length&&e.locationSearch(i[0])},!0)};e.setLocation=function(e){d(e.latitude,e.longitude)};var u=function(){r=document.createElement("ul"),r.classList.add("location-result-container"),r.innerHTML='<li class="location-result handle-overflow" ng-repeat="result in results track by $index" ng-class="{\'active\':activeIndex == $index}" ng-click="$event.stopPropagation(); setLocation(result)" scroll-me="activeIndex == $index">{{result.address}}</li>',n[0].parentNode.insertBefore(r,n[0].nextSibling),r=angular.element(r),r.css("marginTop","7px"),r.attr("ng-show","results.length && active"),t(r)(e),l()},p=function(){a.getGeoLocation(o.$modelValue,function(t,i){t?(e.results=i,e.activeIndex=-1):e.results=[]},["postal_code"])},f=function(){c=!0,i(function(){e.active=!0})},g=function(){c=!1,i(function(){e.active=!1},200)},m=function(t){(13==t.keyCode||9==t.keyCode)&&e.activeIndex>-1&&t.preventDefault()},v=function(t){if((13==t.keyCode||9==t.keyCode)&&e.activeIndex>-1)return t.preventDefault(),t.stopImmediatePropagation(),e.setLocation(e.results[e.activeIndex]),void i(function(){e.activeIndex=-1,e.active=!1});switch(t.keyCode){case 38:t.stopImmediatePropagation(),i(function(){e.activeIndex=Math.max(-1,e.activeIndex-1)});break;case 40:t.stopImmediatePropagation(),i(function(){e.activeIndex=Math.min(e.results.length-1,e.activeIndex+1)})}};angular.element(window).bind("resize",l),n.bind("focus",f),n.bind("blur",g),n.bind("keyup",v),n.bind("keydown",m),e.$watch(function(){return o.$modelValue},function(t){"undefined"==typeof t||""==t?e.results=[]:(!e.active&&c&&(e.active=!0),p())}),e.$on("$destroy",function(){angular.element(window).unbind("resize",l),n.unbind("focus",f),n.unbind("blur",g),n.unbind("keyup",v),n.unbind("keydown",m)}),u()}}}]).directive("dzAutoComplete",["$compile","_","QueryService","$timeout",function(e,t,i,a){return{restrict:"A",require:"ngModel",scope:{ngModel:"=",userId:"="},link:function(n,s,o,r){n.results=[],n.active=!1,n.init=!1,n.activeIndex=-1;var c,l,d=!1,u=!1,p=function(){l.css("width",s[0].clientWidth+"px"),l.css("marginTop",s[0].clientHeight+"px")},f=function(){l=document.createElement("ul"),l.classList.add("ac-container"),l.innerHTML='<li style="text-align:left;" ng-repeat="result in results track by $index" ng-class="{\'active\':activeIndex == $index}" ng-click="setInput(result.val)">{{result.val}}</li>',s[0].parentNode.insertBefore(l,s[0].nextSibling),l=angular.element(l),l.attr("ng-show","results.length && active"),e(l)(n),p()},g=function(e){return"undefined"!==r.$modelValue&&r.$modelValue.length?o.dzMulti?t.filter(e,function(e){return e.val.toLowerCase().indexOf(r.$modelValue.toLowerCase())>-1}):e:[]},m=function(){var e=r.$modelValue;i.queryFacet({query:r.$modelValue,userId:n.userId,facet:{name:o.dzAutoComplete,limit:20,offset:0,query:!0}},function(t,i){t&&(n.results=g(i.facets.dynFilters[o.dzAutoComplete].filters),c=e,n.activeIndex=-1)})};n.setInput=function(e){a(function(){n.ngModel=e,d=!0,s[0].focus()})};var v=function(){return u=!0,d?void(d=!1):(a(function(){n.active=!0}),void(c!=r.$modelValue&&r.$modelValue&&r.$modelValue.length&&m()))},h=function(){u=!1,a(function(){n.active=!1},100)},b=function(e){(13==e.keyCode||9==e.keyCode)&&n.activeIndex>-1&&e.preventDefault()},w=function(e){if((13==e.keyCode||9==e.keyCode)&&n.activeIndex>-1)return e.preventDefault(),e.stopImmediatePropagation(),n.setInput(n.results[n.activeIndex].val),void a(function(){n.activeIndex=-1,n.active=!1});switch(e.keyCode){case 38:e.stopImmediatePropagation(),a(function(){n.activeIndex=Math.max(-1,n.activeIndex-1)});break;case 40:e.stopImmediatePropagation(),a(function(){n.activeIndex=Math.min(n.results.length-1,n.activeIndex+1)})}};angular.element(window).bind("resize",p),s.bind("focus",v),s.bind("blur",h),s.bind("keyup",w),s.bind("keydown",b),n.$watch(function(){return r.$modelValue},function(e){"undefined"==typeof e||""==e?n.results=[]:(!n.active&&u&&(n.active=!0),m())}),n.$on("$destroy",function(){angular.element(window).unbind("resize",p),s.unbind("focus",v),s.unbind("blur",h),s.unbind("keyup",w),s.unbind("keydown",b)}),f()}}}]).directive("parseText",["$compile",function(e){return{restrict:"A",scope:{parseText:"="},link:function(t,i,a){var n=[],s="undefined"!=typeof t.parseText?t.parseText:"";i[0].innerHTML="";var o=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},r=function(e,t){for(var i=[],a=e.exec(t);null!=a;)i.push(a[0]),a=e.exec(t);return i};if("undefined"!=typeof a.parseDisc)for(var c=/(?:https?:\/\/)?(?:www\.)?(?:ec2-54-218-32-190\.us-west-2\.compute\.amazonaws\.com)\/d\/[a-zA-Z0-9-_]+/g,l=r(c,s),d=0;d<l.length;d++){var u='<inline-disc disc-url="'+l[d]+'"></inline-disc>';n.push(u),s=s.split(l[d]).join("+_rep"+(n.length-1)+"+")}if("undefined"!=typeof a.parseUrl)for(var p=/(?:https?:\/\/)?(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b(?:[-a-zA-Z0-9@:%_\+.~#?&//=]*)/g,l=r(p,s),d=0;d<l.length;d++){var f=/^https?:\/\//i.test(l[d])?l[d]:"http://"+l[d];n.push('<a class="dz-blue hover-underline" href="'+f+'" target="_blank">'+l[d]+"</a>"),s=s.split(l[d]).join("+_rep"+(n.length-1)+"+")}s=o(s);for(var d=0;d<n.length;d++)s=s.split("+_rep"+d+"+").join(n[d]);for(var g="",m=s.split("\n"),d=0;d<m.length;d++)g+=m[d].length?/^(\<a|\<inline-disc)/g.test(m[d])?m[d]:"<span>"+m[d]+"</span>":"<br />";i[0].innerHTML='<div class="block-text">'+g+"</div>",e(angular.element(i[0].firstChild))(t.$parent)}}}]).directive("inlineDisc",["_","$timeout","CacheService",function(e,t,i){return{restrict:"E",replace:!0,scope:{discUrl:"@"},template:'<a class="inline-disc hover-underline" ng-href="/d/{{discId}}"><img img-load directive-on="init" directive-set="{\'img-src\':\'{{image}}\'}"/>{{title}}</a>',link:function(a,n,s){var o=/(?:https?:\/\/)?(?:www\.)?(?:ec2-54-218-32-190\.us-west-2\.compute\.amazonaws\.com)\/d\/([a-zA-Z0-9-_]+)/g,r=o.exec(a.discUrl);r?(a.discId=r[r.length-1],i.getDisc(a.discId,function(i,n){i?t(function(){a.image=n.primaryImage?"/files/"+e.findWhere(n.imageList,{_id:n.primaryImage}).fileId:void 0,a.init="undefined"!=typeof a.image,a.title=n.brand+" "+n.name}):a.title="Unknown"})):a.title="Unknown"}}}]).directive("dzHeader",["$window","$location","$timeout","PageUtils","AccountService","MessageService",function(e,t,i,a,n,s){return{restrict:"E",replace:!0,scope:!0,template:'<div class="dz-navbar min-window-width" ng-class="{\'fixed\':fixed}" ng-style="{\'background-color\':\'rgba(74,74,74,\' + (alphaValue/ 100) +\')\'}"><div class="dz-navbar-btn-container float-left"><div class="dz-navbar-btn-list"><a href="/" ng-style="{\'opacity\': alphaValue}"><img src="/static/logo/logo_text.png" class="dz-navbar-logo"></a></div></div><div class="dz-navbar-btn-container float-right"><div class="dz-navbar-btn-list"><div class="dz-navbar-item dz-navbar-dropdown" ng-if="user" ng-click="toggleDropdown()"><div class="default-bg-image" img-load="/static/img/dz_profile.png" img-src="{{getAccountImage()}}" bg-image="true"></div><i class="fa fa-angle-double-down fa-lg" style="line-height:40px;"></i></div><div class="backdrop" ng-show="showOptions" ng-click="toggleDropdown(false)" ng-if="user"></div><ul class="dz-dropdown-menu" ng-show="showOptions" ng-if="user"><li><a href="/account"><span><i class="fa fa-tools fa-cogs"></i></span>Settings</a></li><li class="menu-sep"></li><li><a href="#" id="menu-feedback"><span><i class="fa fa-comment fa-tools"></i></span>Feedback</a></li><li><a href="/faq"><span><i class="fa fa-tools fa-question-circle"></i></span>FAQ</a></li><li><a href="/about"><span><i class="fa fa-tools fa-info-circle"></i></span>About</a></li><li class="menu-sep"></li><li><a href="/logout" data-ajax="false"><span><i class="fa fa-sign-out fa-tools"></i></span>Logout</a></li></ul><div class="dz-navbar-links"><a class="dz-navbar-item dz-navbar-btn" href="/explore" ng-class="{\'active\':isItemActive(\'explore\')}">Explore</a><a class="dz-navbar-item dz-navbar-btn" href="/trunks" ng-class="{\'active\':isItemActive(\'trunks\')}">Trunks</a><a class="dz-navbar-item dz-navbar-btn" ng-if="!user" href="/about" ng-class="{\'active\':isItemActive(\'about\')}">About</a><a class="dz-navbar-item dz-navbar-btn" ng-if="user" ng-href="/t/{{user.username}}" ng-class="{\'active\':isItemActive(\'t/{{user.username}}\')}">My Trunk</a><a class="dz-navbar-item dz-navbar-btn" ng-if="user" ng-href="/inbox" ng-class="{\'active\':isItemActive(\'inbox\')}">Inbox<span ng-show="unreadCount > 0" style="color: #ffa840;"> ({{unreadCount}})</span></a><a class="dz-navbar-item dz-navbar-btn" href="/login" ng-if="!user" ng-class="{\'active\':isItemActive(\'login\')}">Sign In</a><a class="dz-navbar-item dz-navbar-btn" href="/signup" ng-if="!user" ng-class="{\'active\':isItemActive(\'signup\')}">Sign Up</a></div></div></div><div class="clearfix"></div></div>',link:function(o,r,c){o.user=n.getAccount(),o.showOptions=!1,o.unreadCount=0,o.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)};var l=function(){var t=a.getScrollPos(),i=e.innerHeight-50;o.safeApply(function(){o.alphaValue=Math.min(100,t/i*100)})};"true"===c.blend?(o.alphaValue=0,angular.element(document).bind("scroll",l)):o.alphaValue=100,"true"===c.fixed&&(o.fixed=!0),o.getAccountImage=function(){return o.user.image||"/static/img/dz_profile.png"},o.isItemActive=function(e){var i=new RegExp(e+"(\\?.*)?$");return i.test(t.url())},o.toggleDropdown=function(e){"undefined"!=typeof e?o.showOptions=e:o.showOptions=!o.showOptions,console.log("changing state: "+o.showOptions)};var d=function(e){i(function(){o.unreadCount=e.messageCount})};s.addListener(d),o.$on("$destroy",function(){angular.element(document).unbind("scroll",l),s.removeListener(d)})}}}]).directive("dzFooter",["$timeout","PageUtils",function(e,t){return{restrict:"E",replace:!0,template:'<div class="footer-bar" id="footer-bar" ng-init="pgSettings.hasFooter=true;"><div><span class="footer-copyright"><span class="cr-main">Copyright <i class="fa fa-copyright"></i> disc|zump, LLC</span><span class="cr-links"><a href="mailto:support@disczump.com">Contact Us</a><a href="/faq">FAQ</a><a href="/privacy">Privacy Policy</a><a href="/terms">Terms and Conditions</a></span></span><span class="footer-links"><a href="https://www.facebook.com/disczump/" target="_blank"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></a><a href="https://twitter.com/disczump" target="_blank"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-twitter fa-stack-1x fa-inverse"></i></span></a><a href="https://instagram.com/disczump/" target="_blank"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-instagram fa-stack-1x fa-inverse"></i></span></a></span><div class="clearfix"></div></div></div>',link:function(e,t,i){}}}]).directive("dzProfile",["$window","$timeout","CacheService","$compile",function(e,t,i,a){return{restrict:"E",replace:!0,scope:{userId:"@",currentUser:"=",modalOpts:"="},template:'<div class="profile-container"><div class="card-container" ng-show="loaded"><div id="card-remain" style="display: inline-block"><div class="profile-card p-info"><div class="p-info-img"><div class="default-bg-image" img-load="/static/img/dz_profile.png" directive-on="loaded" directive-set="{\'img-src\':\'{{getAccountImage()}}\'}" bg-image="true" ng-class="{\'has-img\':ready}"></div></div><div class="p-info-content p-container"><div class="p-info-icon"><span style="cursor:pointer;" class="fa-stack dz-blue-hover" modal-trigger="dz-profile-modal" data="{\'userId\':\'userId\'}" modal-opts="modalOpts"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-info fa-stack-1x fa-inverse"></i></span></div><div class="p-info-text"><div class="p-username handle-overflow">{{user.username}}</div><div class="p-name handle-overflow">{{user.firstName}} {{user.lastName}}</div></div><div class="p-info-bio fancy-scroll" ng-class="{\'has-ph\':!user.bio}"><span class="placeholder" ng-if="!user.bio">Hello, welcome to my trunk...</span><div parse-text="user.bio" parse-url parse-disc id="user-bio"></div></div></div></div><div class="profile-card p-icon-button" ng-if="currentUser != userId"><div class="p-container"><a class="p-icon-text align-vmid" ng-href="/inbox?userId={{user._id}}"><div class="p-icon-style"><i class="fa fa-envelope"></i></div><div class="p-icon-label">Message</div></a></div></div><div class="profile-card p-icon-button" ng-if="currentUser == userId"><div class="p-container"><a class="p-icon-text align-vmid" href="/d/create/templates"><div class="p-icon-style"><i class="fa fa-plus-circle"></i></div><div class="p-icon-label">Add Disc</div></a></div></div></div><div class="profile-card p-icon-button" ng-show="!cardLoaded"><div class="p-container"><div class="p-icon-text align-vmid"><div class="p-icon-style"><i class="fa fa-spin fa-spinner"></i></div></div></div></div><div ng-style="contStyle" class="card-list" id="card-list" ng-show="cardLoaded"></div></div><div class="explore-nav" ng-show="navArr.length > 1" ng-init="start = 0"><span><i class="fa fa-angle-double-left nav-list-arrow" ng-click="pageBack()" ng-class="{inactive: start == 0}"></i><i class="fa" ng-repeat="i in navArr track by $index" ng-click="navIndex($index)" ng-class="{active: start == $index, \'fa-circle\': start == $index, \'fa-circle-thin\': start != $index}"></i><i class="fa fa-angle-double-right nav-list-arrow" ng-click="pageNext()" ng-class="{inactive: start == navArr.length - 1}"></i></span></div></div>',link:function(n,s,o){function r(){n.cards.push({type:"dz-map-card"}),n.user.verifications.pdga&&n.cards.push({type:"dz-pdga-card"}),n.user.verifications.facebook&&n.cards.push({type:"dz-facebook-card"}),n.cards.push({type:"dz-disc-card"}),n.cards.push({type:"dz-date-card"});var e=document.getElementById("card-list");e&&n.cards.forEach(function(t,i){var t=angular.element("<div "+t.type+' user="user" init="init" ng-show="start < '+(i+1)+" && (showCount + start) >= "+(i+1)+'"></div>');e.appendChild(t[0]),a(t)(n)})}n.init=!1,n.showCount=0,n.cards=[],n.navArr=new Array(0),n.start=0,n.contStyle={},n.navIndex=function(e){n.start=e},n.pageBack=function(){n.start=Math.max(n.start-1,0)},n.pageNext=function(){n.start=Math.min(n.start+1,n.navArr.length-1)},n.getAccountImage=function(){return n.user?n.user.image:"/static/img/dz_profile.png"};var c=function(){t(function(){var e=angular.element(document.getElementById("card-remain"));n.showCount=Math.floor((s[0].clientWidth-e[0].clientWidth)/220),n.navArr=new Array(Math.ceil(n.cards.length/n.showCount)),n.navArr.length>1?s.addClass("with-nav"):s.removeClass("with-nav"),n.contStyle={maxWidth:220*n.showCount+"px"},n.cardLoaded=!0,n.$apply()})};"undefined"!=typeof n.userId&&i.reloadUser(n.userId,function(e,i){e&&t(function(){n.user=i;var e=document.getElementById("user-bio");e&&a(e)(n),n.loaded=!0,t(function(){n.ready=!0}),t(function(){r();var e=angular.element(document.getElementById("card-remain"));n.$watch(function(){return e[0].clientWidth},function(e){"undefined"!=typeof e&&e>0&&(c(),n.init=!0)})},1e3)})}),angular.element(e).bind("resize",c),n.$on("$destroy",function(){angular.element(e).unbind("resize",c)})}}}]).directive("dzPdgaCard",["$timeout",function(e){return{restrict:"A",replace:!0,scope:{user:"="},template:'<div class="profile-card p-icon p-pdga scale-fade"><div class="p-container"><div class="p-icon-text align-vmid"><div class="p-icon-label verified"><span class="fa-stack"><i class="fa fa-certificate fa-stack-2x" aria-hidden="true"></i><i class="fa fa-check fa-stack-1x" aria-hidden="true"></i></span>Verified</div><div class="p-icon-style shadow verified"><i class="fa fa-slack"></i></div><div class="p-icon-label"><a class="dz-blue-hover" target="_blank" ng-href="http://www.pdga.com/player/{{user.pdgaNumber}}">PDGA #{{user.pdgaNumber}}</a></div></div></div></div>',link:function(e,t){}}}]).directive("dzFacebookCard",["$timeout",function(e){return{restrict:"A",replace:!0,scope:{user:"="},template:'<div class="profile-card p-icon p-facebook scale-fade"><div class="p-container"><div class="p-icon-text align-vmid"><div class="p-icon-label verified"><span class="fa-stack"><i class="fa fa-certificate fa-stack-2x" aria-hidden="true"></i><i class="fa fa-check fa-stack-1x" aria-hidden="true"></i></span>Verified</div><div class="p-icon-style shadow verified"><i class="fa fa-facebook-square"></i></div><div class="p-icon-label"><a class="dz-blue-hover" target="_blank" ng-href="https://www.facebook.com/{{user.fbId}}">View Profile</a></div></div></div></div>',link:function(e,t){}}}]).directive("dzDateCard",["$timeout",function(e){return{restrict:"A",replace:!0,scope:{user:"="},template:'<div class="profile-card p-icon p-cal scale-fade"><div class="p-container"><div class="p-icon-text align-vmid"><div class="p-icon-style shadow"><i class="fa fa-calendar"></i></div><div class="p-icon-label">Member Since {{user.dateJoined | date:\'MM/dd/yyyy\'}}</div></div></div></div>',link:function(e,t){}}}]).directive("dzDiscCard",["$timeout",function(e){return{restrict:"A",replace:!0,scope:{user:"="},template:'<div class="profile-card p-count scale-fade"><div class="p-container"><div class="p-count-text align-vmid"><div class="p-count-data">{{user.discCount}}</div><div class="p-count-label">Public Discs</div></div></div></div>',link:function(e,t){}}}]).directive("dzMapCard",["$timeout",function(e){return{restrict:"A",replace:!0,scope:{user:"=",init:"="},template:'<div class="profile-card p-loc scale-fade"><div class="p-container"><div class="align-vmid" id="map-parent"><div id="card-map"></div></div></div></div>',link:function(t,i){var a,n,s;t.mapId=Math.floor(100*Math.random());var o=function(){n=new google.maps.Marker({position:{lat:parseFloat(t.user.geoLat),lng:parseFloat(t.user.geoLng)},animation:google.maps.Animation.DROP,title:t.user.shortLocation,clickable:!1,map:a,icon:{url:"/static/img/disc_marker.png",size:new google.maps.Size(33,49),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(12,49)}})};t.initMap=function(){var e=document.getElementById("card-map");e&&(a=new google.maps.Map(e,{center:{lat:parseFloat(t.user.geoLat),lng:parseFloat(t.user.geoLng)},zoom:4,draggable:!1,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,disableDoubleClickZoom:!0}),o())};var r=t.$watch("init",function(a){if(a===!0){r();var n=t.$watch(function(){return i[0].style.display},function(i){"undefined"!=typeof i&&"none"!==i&&(console.log("showing map"),n(),e(function(){s||(t.initMap(),s=!0)},300))})}});t.$on("$destroy",function(){a=void 0})}}}]).directive("dzStatusBar",[function(){return{restrict:"E",replace:!0,scope:{showCount:"=",totalCount:"=",breadcrumbs:"=",hideOn:"=",homeUrl:"="},template:'<div class="breadcrumb-container"><div class="pagination-container" title="Showing {{showCount}} of {{totalCount}} results" ng-show="$def(showCount)">{{showCount}} | <span class="dz-blue">{{totalCount}}</span></div><div class="breadcrumb-trail" ng-show="!hideOn"><span class="hover-underline" title="Explore Home"><a ng-href="/{{homeUrl}}"><i class="fa fa-home" style="font-size: 1.1em; color: #008edd"></i></a></span><span class="breadcrumb-item-container" ng-repeat="item in breadcrumbs"><span><i class="fa fa-chevron-right"></i><span ng-if="item.title" style="margin-left: 5px">{{item.title}}:</span></span><span class="breadcrumb-item" ng-repeat="link in item.links track by $index"><span ng-if="$index > 0">|</span><a class="dz-blue hover-underline" ng-if="link.href" ng-href="{{link.href}}">{{link.text}}</a><span class="dz-italic" ng-if="!link.href" ng-href="link.href">{{link.text}}</span></span></span></div><div class="clearfix"></div></div>',link:function(e,t,i){"undefined"==typeof e.homeUrl&&(e.homeUrl="explore"),e.$def=function(e){return"undefined"!=typeof e}}}}]).directive("templateItem",function(){return{restrict:"E",replace:!0,scope:{template:"="},template:'<div class="grid-item"><div class="grid-img-container"><div class="grid-img-inner"><div class="grid-img-content"><div><a class="grid-item-nav"></a><img ng-src="{{getPrimaryImage(disc)}}"></div></div></div></div><div class="grid-item-info"><div class="grid-item-label handle-overflow"><a class="hover-underline" ng-href="/d/{{disc._id}}">{{disc.brand}} | <span class="dz-blue">{{disc.name}}</span></a></div><div class="clearfix"></div></div></div>'}}).directive("discItem",["$timeout","QueryService",function(e,t){return{restrict:"E",replace:!0,scope:{disc:"=",currentUser:"=",msOpts:"=",lbOpts:"="},template:'<div class="grid-item" ng-class="{private:!disc.visible}"><div class="grid-item-icon top-left" ng-show="(disc[\'marketplace.forSale\'] || disc[\'marketplace.forTrade\']) && disc.value && !flip"><span class="grid-item-text" ng-if="disc.value">${{disc.value | currency:"":2}}</span></div><div class="grid-item-icon top-right" ng-show="!flip"><i class="fa fa-usd market-icon" ng-class="{\'for-sale\':disc[\'marketplace.forSale\']}" ng-attr-title="{{\'This item is \' + (!disc[\'marketplace.forSale\'] ? \'not \' : \'\') + \'for sale.\'}}"></i><i class="fa fa-exchange market-icon" ng-class="{\'for-trade\':disc[\'marketplace.forTrade\']}" ng-attr-title="{{\'This item is \' + (!disc[\'marketplace.forTrade\'] ? \'not \' : \'\') + \'for trade.\'}}"></i></div><div class="grid-img-container flip" ng-mouseenter="displayHoverIcon=true;" ng-mouseleave="displayHoverIcon=false;"><div class="grid-img-inner"><div class="grid-hover-icon grid-lb-icon" ng-show="displayHoverIcon" ng-click="disc.primaryImage && setLbOpts()" ng-class="{\'show\': displayHoverIcon && !flip, \'disabled\': !disc.primaryImage}" title="Zoom"><span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-search-plus fa-stack-1x fa-inverse"></i></span></div><a ng-href="/d/{{disc._id}}/edit" class="grid-hover-icon grid-edit-icon" ng-show="displayHoverIcon" ng-class="{\'show\': displayHoverIcon && !flip}" ng-if="currentUser && currentUser._id == disc.userId" title="Edit Disc"><span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-pencil fa-stack-1x fa-inverse"></i></span></a><div class="grid-hover-icon grid-info-icon" ng-show="displayHoverIcon" ng-click="flip=!flip;" ng-class="{\'show\': displayHoverIcon, \'remain\': flip}" title="More Info"><span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-info fa-stack-1x fa-inverse"></i></span></div><div class="grid-img-content flip-card" ng-class="{\'flipped\':flip}"><div class="flip-face flip-front"><a class="grid-item-nav" ng-href="/d/{{disc._id}}"></a><img ng-src="{{getSolrPrimaryImage(disc)}}"></div><div class="grid-quick-info flip-face flip-back"><div class="qi-content fancy-scroll"><div class="qi-title">Disc Info</div><div class="qi-item"><div>Brand:</div><div class="handle-overflow">{{disc.brand}}</div></div><div class="qi-item"><div>Name:</div><div class="handle-overflow">{{disc.name}}</div></div><div class="qi-item" ng-if="isDef(disc.type)"><div>Type:</div><div class="handle-overflow">{{disc.type}}</div></div><div class="qi-item" ng-if="isDef(disc.material)"><div>Material:</div><div class="handle-overflow">{{disc.material}}</div></div><div class="qi-item" ng-if="isDef(disc.color)"><div>Color:</div><div class="handle-overflow">{{disc.color}}</div></div><div class="qi-item" ng-if="isDef(disc.weight)"><div>Weight:</div><div class="handle-overflow">{{disc.weight}}g</div></div><div class="qi-item" ng-if="isDef(disc.condition)"><div>Condition:</div><div class="handle-overflow">{{disc.condition}}/10</div></div><div class="qi-item" ng-if="isDef(disc.speed)"><div>Speed:</div><div class="handle-overflow">{{disc.speed}}</div></div><div class="qi-item" ng-if="isDef(disc.glide)"><div>Glide:</div><div class="handle-overflow">{{disc.glide}}</div></div><div class="qi-item" ng-if="isDef(disc.turn)"><div>Turn:</div><div class="handle-overflow">{{disc.turn}}</div></div><div class="qi-item" ng-if="isDef(disc.fade)"><div>Fade:</div><div class="handle-overflow">{{disc.fade}}</div></div><div class="qi-item" ng-if="isDef(disc.value)"><div>Value:</div><div class="handle-overflow">${{disc.value | currency:"":2}}</div></div></div></div></div></div></div><div class="grid-item-info"><div class="private-icon" ng-if="!disc.visible"><i class="fa fa-eye-slash"></i></div><div class="grid-item-label handle-overflow"><a class="hover-underline" ng-href="/d/{{disc._id}}">{{disc.brand}} | <span class="dz-blue">{{disc.name}}</span></a></div><div class="grid-item-text float-left hover-underline" ng-show="!disc.user">{{disc.userId}}</div><div class="grid-item-text float-left hover-underline" ng-show="disc.user"><a ng-href="/t/{{disc.user.username}}">{{disc.user.username}}</a></div><div class="grid-item-text float-right" ng-if="disc.weight">{{disc.weight}}g</div><div class="clearfix"></div></div><div class="overlay-container" ng-show="msOpts.active"><div class="overlay" ng-class="{\'selected\': disc.selected}" ng-click="msOpts.toggleSelected(disc)" ng-init="disc.selected = false"><i class="fa fa-check-circle-o no-animate" ng-show="!disc.selected"></i><i class="fa fa-check-circle no-animate selected" ng-show="disc.selected"></i></div></div></div>',
link:function(e,i,a){e.getSolrPrimaryImage=function(e){return t.getSolrPrimaryImage(e)},e.isDef=function(e){return"undefined"!=typeof e},e.setLbOpts=function(){e.lbOpts.discId=e.disc._id,e.lbOpts.show=!0}}}}]).directive("userItem",["CacheService",function(e){return{restrict:"E",replace:!0,scope:{user:"=",profileModal:"="},template:'<div class="grid-item"><div class="grid-item-icon top-left location handle-overflow" ng-show="location" ng-attr-title="{{location}}"><span><i class="fa fa-street-view"></i>{{location}}</span></div><div class="grid-item-icon top-right cert-icon" ng-if="(user[\'account.verifications.pdga\'] || user[\'account.verifications.facebook\'])" title="Verified User"><span class="fa-stack"><i class="fa fa-certificate fa-stack-2x"></i><i class="fa fa-check fa-stack-1x"></i></span></div><div class="grid-img-container" ng-mouseenter="displayHoverIcon=true;" ng-mouseleave="displayHoverIcon=false;"><div class="grid-img-inner"><div modal-trigger="dz-profile-modal" data="{\'userId\':\'user._id\'}" modal-opts="profileModal" class="grid-hover-icon grid-info-icon" ng-show="displayHoverIcon" ng-class="{\'show\': displayHoverIcon}" title="More Info"><span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-info fa-stack-1x fa-inverse"></i></span></div><div class="default-bg-image" style="width:100%;height:100%;" img-load="/static/img/dz_profile.png" directive-on="init" directive-set="{\'img-src\':\'{{user.image}}\'}" bg-image="true"><a class="grid-item-nav" ng-href="/t/{{user[\'local.username\']}}"></a></div></div></div><div class="grid-item-info"><div class="grid-item-text float-right" ng-attr-title="{{user.discCount}} public disc(s)">{{user.discCount}} <span><i class="fa fa-database" ng-style="discStyle"></i></span></div><div class="grid-item-label handle-overflow text-left"><a class="hover-underline" ng-href="/t/{{user[\'local.username\']}}">{{user[\'local.username\']}}</a></div><div class="grid-item-text float-left">{{user[\'local.firstName\']}}<span ng-if="user[\'local.firstName\']"> </span>{{user[\'local.lastName\']}}</div><a class="grid-item-text float-right hover-underline" ng-if="user[\'local.pdgaNumber\']" target="_blank" ng-href="http://www.pdga.com/player/{{user[\'local.pdgaNumber\']}}">#{{user[\'local.pdgaNumber\']}}</a><div class="clearfix"></div></div></div>',link:function(t,i,a){e.getUser(t.user._id,function(e,i){e&&(t.location=i.shortLocation,t.user.image=i.image,t.user.discCount=i.discCount,t.discStyle={color:i.discCount>=200?"#008EDD":i.discCount>=50?"#8bd1ff":"#bebebe"},t.init=!0)})}}}]).directive("lightbox",["_","$window","$timeout","CacheService",function(e,t,i,a){return{restrict:"E",replace:!0,scope:{discId:"=",curImg:"=",trigger:"=",scrollLock:"="},template:'<div class="full-screen-backdrop no-select" ng-show="showLightbox" ng-click="backdropExit($event);"><div class="lb-container"><div id="lb-content" class="lb-image-block no-focus" tabindex="0" ng-show="isReady"><dz-alert class="full-width" alert-data="lbAlert"></dz-alert><div ng-show="loading"><i class="fa fa-spinner fa-spin fa-6x"></i></div><div ng-show="!loading"><div id="lb-image-list" class="lb-image-list float-left fancy-scroll lite"><img class="image-preview" ng-src="/files/{{img.thumbnailId}}" ng-repeat="img in disc.imageList track by $index" ng-class="{active: index == $index}" ng-click="setImage($index)"></div><div id="lb-image" class="lb-image"><div style="display:table-cell; vertical-align:middle;"><img class="fit-parent" img-load img-src="/files/{{disc.imageList[index].fileId}}"></div></div></div></div></div><div class="lb-x absolute-top-right"><p class="lb-close" ng-click="trigger=false">×</p></div></div>',link:function(n,s,o){var r,c,l,d=100,u=85,p=0,f=0;n.isReady,n.index=0,n.showLightbox=!1,n.lbAlert={},n.disc={},n.backdropExit=function(e){e.target==s[0]&&(n.trigger=!1)};var g=function(){angular.forEach(n.disc.imageList,function(e){var t=new Image;t.src="/files/"+e.fileId})},m=function(e){39==e.keyCode||40==e.keyCode?i(function(){n.index=Math.min(n.disc.imageList.length-1,n.index+1)}):37==e.keyCode||38==e.keyCode?i(function(){n.index=Math.max(0,n.index-1)}):27==e.keyCode&&i(function(){n.trigger=!1})},v=function(){n.isReady||(r=angular.element(document.getElementById("lb-content")),c=angular.element(document.getElementById("lb-image-list")),l=angular.element(document.getElementById("lb-image")),r.bind("keyup",m)),t.innerHeight<t.innerWidth?(f=t.innerHeight-d,r.css("height",f+"px"),r.css("width",t.innerHeight-d+u+"px"),c.css("max-height",f+"px"),l.css("height",f+"px"),l.css("width",f+"px")):(p=t.innerWidth-d,f=p-u,r.css("height",f+"px"),r.css("width",p+"px"),c.css("max-height",f+"px"),l.css("height",f+"px"),l.css("width",f+"px")),r[0].focus(),n.isReady||i(function(){n.isReady=!0})};n.setImage=function(e){i(function(){n.index=e})},n.$watch("trigger",function(t){t===!0?(n.loading=!0,n.scrollLock=!0,n.showLightbox=!0,a.getDisc(n.discId,function(t,a){t?(n.disc.primaryImage=a.primaryImage,n.disc.imageList=a.imageList,g(),n.startImg=n.curImg?n.curImg:n.disc.primaryImage,n.index=e.findIndex(n.disc.imageList,function(e){return e._id==n.startImg}),i(v)):n.lbAlert.error={title:"Error",message:"Error loading disc images.",show:!0},n.loading=!1})):t===!1&&(n.showLightbox=!1,n.scrollLock=!1)}),angular.element(t).bind("resize",v),n.$on("$destroy",function(){angular.element(t).unbind("resize",v),"undefined"!=typeof r&&r.unbind("keyup",m)})}}}]).directive("dropzonePreview",["$compile",function(e){return{restrict:"A",scope:{},link:function(t,i,a){if("true"!==a.compiled){var n=i[0].querySelector(".image-overlay");i.attr("ng-mouseenter","displayOverlay=true;"),i.attr("ng-mouseleave","displayOverlay=false;"),i.attr("compiled","true"),angular.element(n).attr("ng-show","displayOverlay"),e(i)(t.$parent)}}}}]).directive("dropzone",function(){return function(e,t,i){var a,n;a=e[i.dropzone],n=new Dropzone(t[0],a.options),angular.forEach(a.eventHandlers,function(e,t){n.on(t,e)}),e[i.dropzone].getDropzone=function(){return n}}}).directive("imageCropper",["$window","$timeout","ImageService","PageUtils",function(e,t,i,a){return{restrict:"E",scope:{cropperOptions:"=",scrollLock:"="},template:'<div class="backdrop backdrop-dark photo-crop" ng-show="show" ng-style="{\'top\':topMarg + \'px\'}"><div class="crop-container" ng-style="{\'top\':topInnerMarg + \'px\', \'left\':leftInnerMarg + \'px\'}"><div class="crop-area" id="image-parent"></div><div class="crop-control-area"><div class="crop-control"><button type="button" class="btn btn-default" ng-click="cancel($event)"><span><i class="fa fa-trash fa-tools"></i></span>Cancel</button><button type="button" class="btn btn-primary" ng-click="finish($event)"><span><i class="fa fa-save fa-tools"></i></span>Accept</button></div></div></div></div>',replace:!0,link:function(a,n,s){if(a.cropperOptions){var o,r,c;a.show=!1;var l=function(){var i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;t(function(){a.topInnerMarg=(e.innerHeight-500)/2,a.leftInnerMarg=(i-500)/2})},d=function(){var e=document.getElementById("test-crop");o=new Cropper(e,{checkOrientation:!1,aspectRatio:1,autoCropArea:1,dragMode:"move",dragCrop:!1,cropBoxMovable:!1,cropBoxResizable:!1,viewMode:3,built:function(){a.safeApply(function(){a.cropperOptions.cropperLoading=!1})}})};angular.element(e).bind("resize",l),a.$on("$destroy",function(){angular.element(e).unbind("resize load",l)}),a.cropperOptions.showCropper=function(e,i){r=e,c=i,a.safeApply(function(){a.show=!0,a.scrollLock=!0});var n=document.getElementById("image-parent");n.innerHTML='<img src="'+i+'" id="test-crop" filename="'+e+'"/>',t(d)},a.cancel=function(e){e.preventDefault(),t(function(){a.show=!1,a.scrollLock=!1,a.cropperOptions.onFinish(),o.destroy()})},a.finish=function(e){e.preventDefault(),t(function(){a.cropperOptions.cropperLoading=!0,a.show=!1,a.scrollLock=!1}),t(function(){var e=o.getCroppedCanvas().toDataURL(),t=i.dataURItoBlob(e);o.destroy(),t.cropped=!0,t.name=r,a.cropperOptions.onFinish(t)},100)},a.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)},l()}}}}]).directive("smartMsg",[function(){return{restrict:"A",replace:!0,scope:{smartMsg:"="},template:"<span></span>",link:function(e,t,i){e.$watch("smartMsg",function(){if(t[0].innerHTML="","undefined"!=typeof e.smartMsg){if("string"==typeof e.smartMsg)return void(t[0].textContent=e.smartMsg);var i=function(e,t){for(var i=[],a=e.exec(t);null!=a;)i.push(a[1]),a=e.exec(t);return i};if(e.smartMsg.hasOwnProperty("smartConfig")){var a=e.smartMsg.smartConfig,n=a.text,s="";if(a.links)for(var o=/\<\!(.+)\>/g,r=i(o,n),c=0;c<r.length;c++){var l=a.links.length>c?a.links[c]:"#";n=n.split("<!"+r[c]+">").join('<a class="hover-underline dz-blue" href="'+l+'">'+r[c]+"</a>")}s="<span>"+n+"</span>",t[0].innerHTML=s}}})}}}]).directive("dzAlert",["$timeout","PageUtils",function(e,t){return{restrict:"E",scope:{alertData:"=",dock:"@"},replace:!0,template:"<div class=\"message-alert\" ng-class=\"{'dock':dock, 'dock-top': dock == 'top', 'dock-bottom': dock == 'bottom'}\"><div class=\"alert alert-success\" ng-show=\"alertData.success.show\" ng-class=\"{'slide-down': dock == 'top', 'slide-top': dock == 'bottom'}\">"+'<button type="button" class="close" aria-label="Close" ng-click="alertData.success.show=false;" ng-if="!alertData.success.hideClose"><span aria-hidden="true">×</span></button><div class="alert-body"><strong ng-if="alertData.success.title">{{alertData.success.title}}! </strong><span smart-msg="alertData.success.message"></span></div></div><div class="alert alert-info" ng-show="alertData.info.show" ng-class="{\'slide-down\': dock == \'top\', \'slide-top\': dock == \'bottom\'}"><button type="button" class="close" aria-label="Close" ng-click="alertData.info.show=false;" ng-if="!alertData.info.hideClose"><span aria-hidden="true">×</span></button><div class="alert-body"><strong ng-if="alertData.info.title">{{alertData.info.title}}! </strong><span smart-msg="alertData.info.message"></span></div></div><div class="alert alert-danger" ng-show="alertData.error.show" ng-class="{\'slide-down\': dock == \'top\', \'slide-top\': dock == \'bottom\'}"><button type="button" class="close" aria-label="Close" ng-click="alertData.error.show=false;" ng-if="!alertData.error.hideClose"><span aria-hidden="true">×</span></button><div class="alert-body"><strong ng-if="alertData.error.title">{{alertData.error.title}}! </strong><span smart-msg="alertData.error.message"></span></div></div></div>',link:function(i,a,n){var s,o="true"===n.forceScroll,r=function(t){var a=t||3e3;s=e(function(){i.alertData={}},a)},c=function(i){i.show===!0&&"undefined"!=typeof i.timeout?r(i.timeout):s&&e.cancel(s),o&&e(function(){var e=t.getTop(a[0]);(t.getScrollPos()>e||e>t.getScrollPos()+t.getWindowHeight())&&window.scrollTo(0,e)})};i.$watch("alertData.success.show",function(e){"undefined"!=typeof e&&(i.alertData.error={},i.alertData.info={},c(i.alertData.success))}),i.$watch("alertData.error.show",function(e){"undefined"!=typeof e&&(i.alertData.success={},i.alertData.info={},c(i.alertData.error))}),i.$watch("alertData.info.show",function(e){"undefined"!=typeof e&&(i.alertData.success={},i.alertData.error={},c(i.alertData.info))})}}}]).directive("navBack",["$window",function(e){return{restrict:"A",link:function(t,i,a){i.on("click",function(){e.history.back()})}}}]).directive("dzConfirm",["$timeout",function(e){return{restrict:"E",scope:{label:"@",icon:"@",action:"="},replace:!0,template:'<div class="confirm-button" ng-class="{\'open\': confirmActive}" ng-mouseenter="confirmActive && clearReset()" ng-mouseleave="confirmActive && reset()"><div class="confirm-icon" ng-click="toggle()"><i class="fa fa-{{icon}}" title="{{label}}"></i></div><div class="confirm-button-inner dz-blue-hover" ng-show="confirmActive" ng-click="doAction()">{{label}}? Click to Confirm</div><div class="clearfix"></div></div>',link:function(t,i,a){t.confirmActive=!1;var n;t.doAction=function(){t.action()},t.toggle=function(){t.confirmActive=!t.confirmActive},t.clearReset=function(){e.cancel(n)},t.reset=function(){n=e(function(){t.confirmActive=!1,n=void 0},1e3)}}}}]).directive("fitPage",["$window","$timeout",function(e,t){return{restrict:"A",link:function(i,a,n){var s=n.offset?0|parseInt(n.offset):0,o=function(){var t=a[0].children[0];t.clientHeight<=e.innerHeight?angular.element(a).css("height",e.innerHeight+s+"px"):angular.element(a).css("height","auto")};angular.element(e).bind("resize",o),i.$watch(function(){return a[0].children[0].clientHeight},function(e){"undefined"!=typeof e&&o()}),i.$on("$destroy",function(){angular.element(e).unbind("resize",o)}),t(o)}}}]).directive("dzWrapper",["$window","$timeout",function(e,t){return{restrict:"A",link:function(i,a,n){a.addClass("wrapper");var s=function(){t(function(){angular.element(a).css("min-height",e.innerHeight+"px")})};angular.element(e).bind("resize",s),i.$on("$destroy",function(){angular.element(e).unbind("resize",s)}),s()}}}]).directive("fitBelowPage",["$window",function(e){return{restrict:"A",link:function(t,i,a){var n=a.offset?0|parseInt(a.offset):0,s=function(){angular.element(i).css("marginTop",e.innerHeight+n+"px")};angular.element(e).bind("resize",s),t.$on("$destroy",function(){angular.element(e).unbind("resize",s)}),s()}}}]).directive("centerAlign",function(){return{restrict:"A",transclude:!0,template:'<div style="margin: auto; display: table-cell; vertical-align: middle;" ng-transclude></div>',link:function(e,t,i){angular.element(t).css("display","table").css("width","100%")}}}).directive("toggleClass",[function(){return{restrict:"A",link:function(e,t,i){t.bind("click",function(){t.toggleClass(i.toggleClass)})}}}]).directive("directiveOn",["$compile",function($compile){return{scope:{trigger:"=directiveOn"},restrict:"A",link:function(scope,element,attrs){var directive=eval("("+attrs.directiveSet+")"),setDirective=function(){directive=eval("("+attrs.directiveSet+")");for(var a in directive)element.attr(a,directive[a]);element.removeAttr("directive-on"),element.removeAttr("directive-set"),$compile(angular.element(element[0]))(scope.$parent)};"object"==typeof directive&&(scope.trigger===!0?setDirective():scope.$watch("trigger",function(e,t){e===!0&&setDirective()}))}}}]).directive("infiniteScroll",["$window",function(e){return{restrict:"A",link:function(t,i,a){var n=i[0],s=function(i){var s=n.getBoundingClientRect(),o=s.top+window.pageYOffset-document.documentElement.clientTop;o+n.clientHeight<=e.scrollY+window.innerHeight&&t.$apply(a.infiniteScroll)};angular.element(e).bind("scroll load",s),t.$on("$destroy",function(){angular.element(e).unbind("scroll load",s)})}}}]).directive("ngRepeatFinish",["$parse",function(e){return{restrict:"A",link:function(t,i,a){t.$last&&e(a.ngRepeatFinish)(t)}}}]).directive("imgLoad",[function(){return{restrict:"A",link:function(e,t,i){function a(e){o?t.css("background-image","url("+e+")"):i.$set("src",e)}function n(){var e=new Image;e.addEventListener("load",function(){a(e.src)}),e.src=i.imgSrc,e.complete||a(i.imgLoad||"/static/img/dz_disc.png")}function s(){i.$observe("imgSrc",function(){n()})}var o="true"===i.bgImage;i.imgSrc?n():a(i.imgLoad||"/static/img/dz_disc.png"),s()}}}]).directive("tagList",["$timeout","_","QueryService",function(e,t,i){return{restrict:"E",scope:!0,template:'<div class="text-list"><a class="text-item tag" ng-href="{{getLink(tag)}}" ng-repeat="tag in tagList track by $index" ng-class="{\'large\':$index < limitLarge, \'med\': ($index >= limitLarge && $index < limitMed)}">{{tag.val}}</a></div>',replace:!0,link:function(t,a,n){t.tagList=[],t.getLink=function(e){return"/explore?mode=all-market&q="+encodeURIComponent(e.val)},i.queryFacet({query:"*",limit:0,marketplace:{forSale:!0,forTrade:!0},facet:{name:"tag",limit:50}},function(i,a){i&&a.facets.dynFilters.tag&&e(function(){t.tagList=a.facets.dynFilters.tag.filters||[],t.limitLarge=Math.floor(.25*t.tagList.length),t.limitMed=Math.floor(.5*t.tagList.length)})})}}}]).directive("exploreCategory",["$window","$location","$timeout","_","QueryService",function(e,t,i,a,n){return{restrict:"E",scope:!0,template:'<div class="explore-category"><div class="explore-cat-label dz-label">Explore | <span class="dz-blue">{{fvalue}}</span><span class="dz-blue hover-underline" style="float: right; cursor: pointer"><a ng-href="{{getLink()}}">See More...</a></span></div><div class="explore-cat-list" fade-time="100" fade-scroll="true"><div class="explore-item no-results" ng-show="!exploreList.length"><div>No Results</div></div><div class="explore-item" ng-repeat="disc in exploreList | startFrom:start | limitTo:dispCount"><a ng-href="/d/{{disc._id}}"><div class="explore-item-icon top-left" ng-show="(disc[\'marketplace.forSale\'] || disc[\'marketplace.forTrade\']) && disc.value"><span class="explore-item-text">${{disc.value | currency:"":2}}</span></div><div class="explore-item-icon top-right"><i class="fa fa-usd market-icon" ng-class="{\'for-sale\':disc[\'marketplace.forSale\']}"></i><i class="fa fa-exchange market-icon" ng-class="{\'for-trade\':disc[\'marketplace.forTrade\']}"></i></div><img img-src="{{getSolrPrimaryImage(disc)}}" img-load /><div class="explore-item-title handle-overflow">{{disc.brand}} | <span class="dz-blue">{{disc.name}}</span></div></a></div><div class="clearfix"></div></div><div class="explore-nav" ng-show="$def(navArr) && navArr.length > 1" ng-init="page = 0"><span><i class="fa fa-angle-double-left nav-list-arrow" ng-click="pageBack()" ng-class="{inactive: page == 0}"></i><i class="fa" ng-repeat="i in navArr track by $index" ng-click="navIndex($index)" ng-class="{active: start == $index * dispCount, \'fa-circle\': start == $index * dispCount, \'fa-circle-thin\': start != $index * dispCount}"></i><i class="fa fa-angle-double-right nav-list-arrow" ng-click="pageNext()" ng-class="{inactive: page == navArr.length - 1}"></i></span></div></div>',replace:!0,link:function(t,a,s){var o="true"===s.recent;t.fvalue=o?"Recently Added":s.fvalue,t.start=0,t.dispCount=Math.floor(a[0].clientWidth/156),t.exploreList=[];var r=[];o||r.push({name:s.field,fields:[s.fvalue]}),t.getLink=function(){return"/explore?mode=all-market"+(o?"":"&s=new&f_0="+s.field+":"+encodeURIComponent(s.fvalue))},t.navIndex=function(e){t.page=e,t.start=t.page*t.dispCount},t.pageBack=function(){t.page=Math.max(0,t.page-1),t.start=t.page*t.dispCount},t.pageNext=function(){t.page=Math.min(t.page+1,t.navArr.length-1),t.start=t.page*t.dispCount},t.getDisplayCount=function(){i(function(){t.dispCount=Math.floor(a[0].clientWidth/156),t.navArr=new Array(Math.ceil(t.exploreList.length/t.dispCount)),t.page=Math.min(t.page,t.navArr.length-1),t.start=t.page*t.dispCount})};var c=function(){t.getDisplayCount()};angular.element(e).bind("resize",c),t.$on("$destroy",function(){angular.element(e).unbind("resize",c)});var l={query:"*",sort:"new",limit:20,marketplace:{forSale:!0,forTrade:!0}};o||(l.filter=r,l.group={limit:3,field:"userId"}),n.queryAll(l,function(e,i){if(e){if(o)Array.prototype.push.apply(t.exploreList,i.results);else for(var a in i.results)Array.prototype.push.apply(t.exploreList,i.results[a]);t.navArr=new Array(Math.ceil(t.exploreList.length/t.dispCount))}})}}}]).directive("modalTrigger",["$parse","$timeout",function($parse,$timeout){return{restrict:"A",scope:{modalOpts:"="},link:function(scope,elem,attrs){var data={};if(attrs.data){var dataExp=eval("("+attrs.data+")");for(var a in dataExp)data[a]=$parse(dataExp[a])(scope.$parent)}var showModal=function(){$timeout(function(){scope.modalOpts.data=data,scope.modalOpts.type=attrs.modalTrigger,scope.modalOpts.show=!0})};scope.$on("$destroy",function(){elem.unbind("click",showModal)}),elem.bind("click",showModal)}}}]).directive("dzModal",["$compile","$window","$timeout",function(e,t,i){return{restrict:"E",scope:{scrollLock:"=",modalOpts:"="},replace:!0,template:'<div class="full-screen-backdrop no-select" ng-show="showModal"><div class="dz-modal-container" id="dz-modal"><i class="dz-modal-close fa fa-times" aria-hidden="true" ng-click="!childOpts.lock && (modalOpts.show = false)"></i><div id="dz-modal-inner"></div></div></div>',link:function(a,n,s){a.childOpts={lock:!1,doOnClose:!1},a.resize=function(){var e=document.getElementById("dz-modal");i(function(){angular.element(e).css("max-height",.8*t.innerHeight+"px")})},a.$watch("modalOpts.show",function(t){if("undefined"!=typeof t){var n=document.getElementById("dz-modal-inner");if(n.innerHTML="",!t)return a.scrollLock=!1,a.showModal=!1,void("undefined"!=typeof a.modalOpts.data.onClose&&a.modalOpts.data.onClose(a.childOpts.doOnClose));var s=angular.element("<"+a.modalOpts.type+' data="modalOpts.data" show="modalOpts.show" lock="childOpts.lock" do-on-close="childOpts.doOnClose"></'+a.modalOpts.type+">");n.appendChild(s[0]),e(s)(a),a.scrollLock=!0,i(function(){a.showModal=!0})}}),a.$on("$destroy",function(){angular.element(t).unbind("resize",a.resize)}),angular.element(t).bind("resize",a.resize),a.resize()}}}]).directive("dzInfoModal",["$window","$timeout",function(e,t){return{restrict:"E",scope:{data:"=data",show:"="},replace:!0,template:'<div><div class="dz-modal-content"><div class="dz-modal-title-info" id="modal-title"><i class="fa fa-question-circle fa-tools"></i></div><div id="modal-body" style="overflow:auto;"></div></div><div class="dz-modal-btn-container"><div class="dz-modal-triangle"></div><div class="dz-modal-btn cancel" ng-click="show = false">Close</div></div></div>',link:function(i,a,n){document.getElementById("modal-title").innerHTML+=i.data.title;var s=document.getElementById("modal-body");s.innerHTML=i.data.body,i.resize=function(){t(function(){angular.element(s).css("max-height",.8*e.innerHeight-200+"px")})},i.$on("$destroy",function(){angular.element(e).unbind("resize",i.resize)}),angular.element(e).bind("resize",i.resize),i.resize()}}}]).directive("dzBumpModal",["_","DiscService",function(e,t){return{restrict:"E",scope:{data:"=data",show:"=",lock:"=",doOnClose:"="},replace:!0,template:'<div><div class="dz-modal-content"><div class="dz-modal-title-sm left">Bump Discs</div><div class="dz-modal-text">The table below shows each bump status of the selected discs. Clicking "Bump" will automatically bump all available discs in the table below.</div><dz-alert class="full-width" alert-data="modalAlert"></dz-alert><dz-modal-table table-opts="tableOpts"></dz-modal-table></div><div class="dz-modal-btn-container"><div class="dz-modal-triangle"></div><div class="dz-modal-btn loading" ng-show="opts.loading"><i class="fa fa-spinner fa-spin fa-lg"></i></div><div class="dz-modal-btn cancel" ng-show="!opts.loading" ng-click="show = false">Close</div><div class="dz-modal-btn btn-blue" ng-click="confirm()" ng-show="!opts.loading && !opts.hideBump">Bump</div></div></div>',link:function(i,a,n){i.tableOpts={isCounter:!0,isDisc:!0,headerText:"Disc",successText:"Bumped",defaultText:"Bump Ready",items:i.data.discs},i.opts={},i.modalAlert={},i.confirm=function(){e.each(i.data.discs,function(e){"undefined"!=typeof e.countdown&&e.countdown.bumpReady&&(i.opts.loading=!0,i.doOnClose=!0,i.lock=!0,t.bumpDisc(e._id,function(t,a){t?e.success=!0:i.modalAlert.error={title:a.type,message:a.message,show:!0},i.opts.loading=!1,i.opts.hideBump=!0,i.lock=!1}))})}}}}]).directive("dzTagModal",["_","$timeout","DiscService",function(e,t,i){return{restrict:"E",scope:{data:"=data",show:"=",lock:"=",doOnClose:"="},replace:!0,template:'<div><div class="dz-modal-content"><div class="dz-modal-title-sm left">Multi-select Tag Manager</div><div class="dz-modal-text">Tags shown below are common to all selected discs. Use this window to add and remove tags to/from multiple discs at once. When saved, all tags in this list will be added to the discs below.</div><dz-alert class="full-width" alert-data="tagAlert"></dz-alert><div ng-show="opts.loading" style="line-height:105px;"><i class="fa fa-spinner fa-spin fa-3x"></i></div><div ng-show="!opts.loading"><div style="position:relative;"><input type="text" class="dz-modal-tag-input" placeholder="Enter tag and press enter..." ng-model="tempTag" ng-model-options="{\'updateOn\':\'default blur\',\'debounce\':{\'default\':500,\'blur\':0}}" ng-model-enter="pushTempTag();" directive-on="opts.isShowing" directive-set="{\'dz-auto-complete\':\'tag\'}" user-id="data.user" dz-multi="true" ></div><div class="dz-modal-tag-container"><li class="tag-item" ng-repeat="tag in newTags"><div>{{tag}}<span class="tag-item-remove" ng-click="removeNewTag($index)"><i class="fa fa-times"></i></span></div></li></div><div style="text-align:left;"><span style="margin-right:5px;"><i class="fa fa-square-o hover-pointer" ng-show="!opts.overwrite" aria-hidden="true" ng-click="opts.overwrite = !opts.overwrite"></i><i class="fa fa-check-square-o hover-pointer" ng-show="opts.overwrite" aria-hidden="true" ng-click="opts.overwrite = !opts.overwrite"></i></span><span class="hover-pointer" ng-click="opts.overwrite = !opts.overwrite">Overwrite Tags</span><span><i class="fa fa-question-circle hover-pointer" aria-hidden="true" style="margin-left:4px;" ng-click="showOverwriteAlert()"></i></span></div></div><dz-alert class="full-width" alert-data="overwriteAlert" style="text-align:left;"></dz-alert><dz-modal-table table-opts="tableOpts"></dz-modal-table></div><div class="dz-modal-btn-container"><div class="dz-modal-triangle"></div><div class="dz-modal-btn loading" ng-show="opts.loading"><i class="fa fa-spinner fa-spin fa-lg"></i></div><div class="dz-modal-btn cancel" ng-show="!opts.loading" ng-click="show = false">Close</div><div class="dz-modal-btn btn-blue" ng-click="opts.allowSave && confirm()" ng-show="!opts.loading" ng-class="{disabled:!opts.allowSave}">Save</div></div></div>',link:function(a,n,s){var o=e.intersection.apply(e,e.pluck(a.data.discs,"tag"));a.newTags=o.slice(),a.tempTag="",a.opts={},a.modalAlert={},a.tagAlert={},a.overwriteAlert={},a.tableOpts={isDisc:!0,headerText:"Disc",successText:"Saved",defaultText:"Unchanged",items:a.data.discs},a.removeNewTag=function(e){a.newTags.splice(e,1)[0]},a.pushTempTag=function(){"undefined"!=typeof a.tagAlert.error&&(a.tagAlert.error.show=!1),a.tempTag&&a.tempTag.length&&(e.contains(a.newTags,a.tempTag)?a.tagAlert.error={title:"Error",message:'"'+a.tempTag+'" already exists as a common tag.',show:!0}:(a.newTags.push(a.tempTag),a.tempTag=""))},a.showOverwriteAlert=function(){a.overwriteAlert.info={message:"Enabling this option will REPLACE all tags across all selected discs with the tag list shown above!",show:!0}},a.confirm=function(){var t=e.difference(o,a.newTags),n=function(s,o,r){var c=s[o],l="undefined"!=typeof c.tag?c.tag:[];l=a.opts.overwrite?a.newTags:e.uniq(e.union(e.difference(l,t),a.newTags)),"undefined"!=typeof c.success&&(c.success=!1),"undefined"!=typeof c.error&&(c.error=!1),i.editDisc({tagList:l,_id:c._id},function(e,t){e?c.success=!0:c.error=!0,o<s.length-1?n(s,o+1,r):r()})};a.opts.loading=!0,a.doOnClose=!0,a.lock=!0,n(a.data.discs,0,function(){a.tagAlert.info={title:"Finished",message:"Tag update is complete.",show:!0},o=a.newTags.slice(),a.opts.allowSave=!1,a.opts.loading=!1,a.lock=!1})},a.$watch("show",function(e){t(function(){e===!0&&(a.opts.isShowing=!0)},500)}),a.$watch("opts.overwrite",function(e){"undefined"!=typeof e&&e===!0&&(a.opts.allowSave=!0,a.showOverwriteAlert())}),a.$watchCollection("newTags",function(t){if("undefined"!=typeof t)if(t.length!=o.length)a.opts.allowSave=!0;else{var i=e.intersection(t,o);a.opts.allowSave=i.length!=t.length}})}}}]).directive("dzProfileModal",["_","$compile","$window","$timeout","$location","CacheService","MembershipService","AccountService",function(e,t,i,a,n,s,o,r){return{restrict:"E",scope:{data:"=data",show:"=",lock:"="},replace:!0,template:'<div><div class="dz-modal-content"><dz-alert class="full-width" alert-data="modalAlert"></dz-alert><div ng-show="opts.loading"><i class="fa fa-spinner fa-spin fa-lg"></i></div><div ng-show="userInit && !opts.loading"><div class="dz-modal-profile-table" id="profile-table"><div class="dz-modal-profile-cell right"><div class="handle-overflow" style="font-weight:bold;font-size:20px;">{{user.username}}</div><div class="handle-overflow">{{user.firstName}} {{user.lastName}}</div><div class="handle-overflow">{{user.shortLocation}}</div></div><div class="dz-modal-profile-cell"><div class="dz-modal-profile-img default-bg-image" img-load="/static/img/dz_profile.png" img-src="{{getUserImage()}}" bg-image="true"></div></div><div class="dz-modal-profile-cell left"><div class="handle-overflow">{{getAccountName()}}</div><div class="handle-overflow">{{user.discCount}} Public Discs</div><div class="handle-overflow">Member since {{user.dateJoined | date:\'MM/dd/yyyy\'}}</div><div class="handle-overflow"><i style="width:14px;" class="fa fa-check fa-tools" aria-hidden="true" ng-class="{\'fa-success\':user.pdgaNumber,\'fa-gray\':!user.pdgaNumber}"></i>PDGA Verified</div><div class="handle-overflow"><i style="width:14px;" class="fa fa-check fa-tools" aria-hidden="true" ng-class="{\'fa-success\':user.fbId,\'fa-gray\':!user.fbId}"></i>Facebook Verified</div></div></div><div class="dz-modal-bio" id="modal-bio" parse-text="user.bio" parse-url parse-disc ng-if="user.bio">{{user.bio}}</div></div></div><div class="dz-modal-btn-container"><div class="dz-modal-triangle"></div><div class="dz-modal-btn cancel" ng-show="!opts.loading" ng-click="show = false">Close</div><div class="dz-modal-btn btn-blue" ng-if="!isOwner" ng-show="!opts.loading" ng-click="initMessage()">Message</div><div class="dz-modal-btn trunk" ng-if="!isTrunk" ng-show="!opts.loading" ng-click="viewTrunk()">View Trunk</div><div class="dz-modal-btn btn-blue" ng-if="isOwner" ng-show="!opts.loading" ng-click="viewAccount()">My Account</div></div></div>',link:function(c,l,d){var u,p=document.getElementById("modal-bio"),f=document.getElementById("profile-table"),g=document.getElementsByClassName("dz-modal-profile-cell");c.opts={},c.modalAlert={},c.getUserImage=function(){return c.user.image,c.user.image},c.getAccountName=function(){return o.getAccountName(c.user.accountType)},c.initMessage=function(){n.path("/inbox").search("userId",c.user._id)},c.viewTrunk=function(){n.path("/t/"+c.user.username)},c.viewAccount=function(){n.path("/account")},c.resize=function(){a(function(){angular.element(p).css("max-height",.8*i.innerHeight-300+"px"),u=f.offsetWidth/3,e.each(g,function(e){angular.element(e).css("width",u+"px"),angular.element(e).css("max-width",u+"px")})})},c.$on("$destroy",function(){angular.element(i).unbind("resize",c.resize)}),angular.element(i).bind("resize",c.resize),c.opts.loading=!0,c.lock=!0;var m=n.path();c.isTrunk=m.search("/t/")!=-1,s.getUser(c.data.userId,function(e,i){e?(c.user=i,c.isOwner=r.compareTo(i._id),p&&t(p)(c),c.userInit=!0):c.modalAlert.error={title:"Error",message:"Error retrieving profile.",show:!0},c.opts.loading=!1,c.lock=!1}),a(function(){c.resize()})}}}]).directive("dzDeleteAccountModal",["AccountService",function(e){return{restrict:"E",scope:{data:"=data",show:"=",lock:"="},replace:!0,template:'<div><div class="dz-modal-content"><div class="dz-modal-title-sm left"><img class="dz-modal-title-img" ng-src="{{getAccountImage()}}" />Delete Account - {{data.account.username}}</div><dz-alert class="full-width" alert-data="modalAlert"></dz-alert><i class="fa fa-5x fa-exclamation-triangle" style="color:#e85947"></i><div class="dz-modal-title-lg">Warning!</div><div class="dz-modal-text">Are you sure you want to permanently delete your disc|zump account?</div><br><div class="dz-modal-text">Upon clicking delete, a confirmation email will be sent to your disc|zump account email address. Click the link in this email to complete the deletion process.</div></div><div class="dz-modal-btn-container"><div class="dz-modal-triangle"></div><div class="dz-modal-btn loading" ng-show="opts.loading"><i class="fa fa-spinner fa-spin fa-lg"></i></div><div class="dz-modal-btn cancel" ng-show="!opts.loading" ng-click="show = false">Close</div><div class="dz-modal-btn" ng-show="!opts.loading && !opts.confirmed" ng-click="!opts.loading && confirm()" style="background-color: #e85947">Delete</div></div></div>',
link:function(t,i,a){t.opts={},t.modalAlert={},t.getAccountImage=function(){return e.getAccountImage()},t.confirm=function(){t.opts.loading=!0,t.lock=!0,e.doAccountDelete(function(e,i){e&&"OK"==i.status?(t.modalAlert.success={title:"Success",message:"An email confirmation has been sent to your email address.",show:!0},t.opts.confirmed=!0):t.modalAlert.error={title:"Error",message:"An error occurred while attempting to delete your account.",show:!0},t.opts.loading=!1,t.lock=!1})}}}}]).directive("dzDeleteDiscModal",["DiscService",function(e){return{restrict:"E",scope:{data:"=data",show:"=",lock:"=",doOnClose:"="},replace:!0,template:'<div><div class="dz-modal-content"><i class="fa fa-5x fa-exclamation-triangle" style="color:#e85947"></i><div class="dz-modal-title-lg">Warning!</div><div class="dz-modal-message">Are you sure you want to permanently delete the selected discs?</div><dz-alert class="full-width" alert-data="modalAlert"></dz-alert><dz-modal-table table-opts="tableOpts"></dz-modal-table></div><div class="dz-modal-btn-container"><div class="dz-modal-triangle"></div><div class="dz-modal-btn loading" ng-show="opts.loading"><i class="fa fa-spinner fa-spin fa-lg"></i></div><div class="dz-modal-btn cancel" ng-show="!opts.loading" ng-click="show = false"><span ng-show="!doOnClose">Cancel</span><span ng-show="doOnClose">Close</span></div><div class="dz-modal-btn" ng-show="!opts.loading && !doOnClose" ng-click="!opts.loading && confirm()" style="background-color: #e85947">Delete</div></div></div>',link:function(t,i,a){t.opts={},t.modalAlert={},t.tableOpts={isDisc:!0,headerText:"Disc",successText:"Deleted",defaultText:"Unchanged",items:t.data.discs},t.confirm=function(){var i=function(t,a,n){var s=t[a];e.deleteDisc(s,function(e,o){e?s.success=!0:s.error=!0,a<t.length-1?i(t,a+1,n):n()})};t.opts.loading=!0,t.doOnClose=!0,t.lock=!0,i(t.data.discs,0,function(){t.modalAlert.info={title:"Finished",message:"Disc deletion is complete.",show:!0},t.opts.loading=!1,t.lock=!1})}}}}]).directive("dzVisibilityModal",["DiscService",function(e){return{restrict:"E",scope:{data:"=data",show:"=",lock:"=",doOnClose:"="},replace:!0,template:'<div><div class="dz-modal-content"><div class="dz-modal-title-sm left">Multi-select Visibility Manager</div><div class="dz-modal-text">Change the visibility setting for all discs selected below.</div><div class="page-info error" ng-show="!makePublic">Warning! Making discs private will automatically remove them from the marketplace.</div><div><div class="dz-modal-action sm hover-pointer" ng-click="makePublic = true;" ng-class="{active: makePublic}"><div><i class="fa fa-eye" aria-hidden="true" style="font-size:4em;"></i></div><div class="dz-modal-action-text">Public</div></div><div class="dz-modal-action sm hover-pointer" ng-click="makePublic = false;" ng-class="{active: !makePublic}"><div><i class="fa fa-eye-slash" aria-hidden="true" style="font-size:4em;"></i></div><div style="font-weight:bold;font-size:20px;">Private</div></div></div><dz-modal-table table-opts="tableOpts"></dz-modal-table></div><div class="dz-modal-btn-container"><div class="dz-modal-triangle"></div><div class="dz-modal-btn loading" ng-show="opts.loading"><i class="fa fa-spinner fa-spin fa-lg"></i></div><div class="dz-modal-btn cancel" ng-show="!opts.loading" ng-click="show = false">Close</div><div class="dz-modal-btn btn-blue" ng-click="!opts.loading && confirm()" ng-show="!opts.loading">Save</div></div></div>',link:function(t,i,a){t.opts={},t.modalAlert={},t.tableOpts={isDisc:!0,isVisibility:!0,headerText:"Disc",items:t.data.discs},t.makePublic=!0,t.confirm=function(){var i=function(a,n,s){var o=a[n];"undefined"!=typeof o.success&&(o.success=!1),"undefined"!=typeof o.error&&(o.error=!1),e.editDisc({visible:t.makePublic,_id:o._id},function(e,r){e?(o.visible=t.makePublic,o.success=!0):o.error=!0,n<a.length-1?i(a,n+1,s):s()})};t.opts.loading=!0,t.doOnClose=!0,t.lock=!0,i(t.data.discs,0,function(){t.opts.loading=!1,t.lock=!1})}}}}]).directive("dzMarketplaceModal",["DiscService","AccountService",function(e,t){return{restrict:"E",scope:{data:"=data",show:"=",lock:"=",doOnClose:"="},replace:!0,template:'<div><div class="dz-modal-content"><div class="dz-modal-title-sm left">Multi-select Marketplace Manager</div><div class="dz-modal-text">Change the marketplace settings for all discs selected below. Upon saving, all marketplace settings will be overwritten for selected discs.</div><dz-alert class="full-width" alert-data="modalAlert"></dz-alert><div style="border-bottom:1px solid #BEBEBE;height:30px;"><div class="dz-modal-market-info handle-overflow"><span>Account Type: </span>{{data.marketData.accountName}}</div><div class="dz-modal-market-info handle-overflow" ng-show="data.marketData.marketCap != -1"><span>Cap: </span>{{data.marketData.marketCap}}</div><div class="dz-modal-market-info handle-overflow" ng-show="data.marketData.marketCap == -1"><span>Cap: </span>Unlimited</div><div class="dz-modal-market-info handle-overflow" ng-show="data.marketData.marketCap != -1"><span>Remaining: </span>{{data.marketData.marketAvailable}}</div><div class="dz-modal-market-info handle-overflow" ng-show="data.marketData.marketCap == -1"><span>Remaining: </span>Unlimited</div></div><div class="page-info error center full-width" style="margin:5px auto" ng-show="data.marketData.marketCap > 0 && (tempMarketplace.forSale || tempMarketplace.forTrade)"><span class="page-info-title inline">Warning!</span>  You have a limited marketplace cap. Discs will update sequentially until this cap is reached.</div><div class="page-info error center full-width" style="margin:5px auto" ng-show="data.isIneligible">Marketplace eligibility requires each disc to be public and have at least one image.</div><div><div style="display:inline-block;width:50%;line-height:50px;"><div>For Sale: <switch class="marketplace-switch ms-modal sale-switch" type="checkbox" ng-model="tempMarketplace.forSale"></switch></div></div><div style="display:inline-block;width:50%;line-height:50px;"><div>For Trade: <switch class="marketplace-switch ms-modal trade-switch" type="checkbox" ng-model="tempMarketplace.forTrade"></switch></div></div></div><dz-modal-table table-opts="tableOpts" class="no-margin"></dz-modal-table></div><div class="dz-modal-btn-container"><div class="dz-modal-triangle"></div><div class="dz-modal-btn loading" ng-show="opts.loading"><i class="fa fa-spinner fa-spin fa-lg"></i></div><div class="dz-modal-btn cancel" ng-show="!opts.loading" ng-click="show = false">Close</div><div class="dz-modal-btn btn-blue" ng-click="!opts.loading && confirm()" ng-show="!opts.loading">Save</div></div></div>',link:function(i,a,n){i.opts={},i.modalAlert={},i.tempMarketplace={forSale:!1,forTrade:!1},i.tableOpts={isDisc:!0,isMarketplace:!0,headerText:"Disc",items:i.data.discs},i.confirm=function(){var a=function(t,a,s){var o=t[a];return o.ineligible?n(t,a,s):(o.success=!1,o.error=!1,void e.editDisc({marketplace:i.tempMarketplace,_id:o._id},function(e,r){return e?(o["marketplace.forSale"]=i.tempMarketplace.forSale,o["marketplace.forTrade"]=i.tempMarketplace.forTrade,o.success=!0):o.error=!0,n(t,a,s)}))},n=function(e,t,i){return t<e.length-1?a(e,t+1,i):i()};i.opts.loading=!0,i.doOnClose=!0,i.lock=!0,a(i.data.discs,0,function(){t.getAccountMarket(function(e,t){e||(i.modalAlert.error={title:"Error",message:"Error updating marketplace remaining count.",show:!0}),i.data.marketData.marketAvailable=t.marketAvailable}),i.opts.loading=!1,i.lock=!1})}}}}]).directive("dzShareModal",["_","$location","$timeout","QueryService","AccountService","FacebookUtils",function(e,t,i,a,n,s){return{restrict:"E",scope:{data:"=data",show:"=",lock:"="},replace:!0,template:'<div><div class="dz-modal-content"><div class="dz-modal-title-sm left" ng-if="isDisc"><img class="dz-modal-title-img" img-load img-src="{{getDiscImage(data.disc)}}" />Share {{data.disc.brand}} {{data.disc.name}}</div><div class="dz-modal-title-sm left" ng-if="isTrunk"><img class="dz-modal-title-img" img-load="/static/img/dz_profile.png" img-src="{{getAccountImage()}}" />Share Trunk - {{data.user.username}}</div><div class="dz-modal-text" ng-show="!linkOpts.linkSelected">Share this {{typeText}} directly to Facebook, or send the public link to any internet enabled device. Click an icon below to continue.</div><div class="dz-modal-text" ng-show="linkOpts.linkSelected">Copy the public link below and share it with the world!</div><dz-alert class="full-width" alert-data="modalAlert"></dz-alert><div ng-show="!linkOpts.linkSelected"><dz-alert class="full-width" alert-data="fbModalAlert"></dz-alert><div class="dz-modal-action hover-pointer" ng-click="!loading.fb && facebookInit && shareFB()" ng-class="{disabled: !facebookInit}"><div ng-show="loading.fb"><i class="fa fa-spin fa-spinner" aria-hidden="true" style="font-size:7em;"></i></div><div ng-show="!loading.fb"><i class="fa fa-facebook-square fb-color" aria-hidden="true" style="font-size:7em;"></i></div><div class="dz-modal-action-text" ng-class="{disabled: !facebookInit}">Facebook</div></div><div class="dz-modal-action hover-pointer" ng-click="showLink()"><div><i class="fa fa-link link-color" aria-hidden="true" style="font-size:7em;"></i></div><div style="font-weight:bold;font-size:20px;">Public Link</div></div></div><div ng-show="linkOpts.linkSelected"><form name="linkForm" class="dz-modal-link-form" ng-if="isTrunk"><div class="dz-modal-link-form-row"><label class="dz-blue-hover"><input type="radio" ng-model="formData.linkType" value="full"><span>Share current view (maintaining filter, search, and sort settings).</span></label></div><div class="dz-modal-link-form-row"><label class="dz-blue-hover"><input type="radio" ng-model="formData.linkType" value="base"><span>Share <span ng-if="isOwner">your</span><span ng-if="!isOwner">this</span> entire trunk.</span></label></div></form><input id="input-link" class="no-focus no-border" style="width:100%;padding:5px;" type="text" ng-model="linkOpts.link"></input></div></div><div class="dz-modal-btn-container"><div class="dz-modal-triangle"></div><div class="dz-modal-btn cancel" ng-click="linkOpts.linkSelected = !linkOpts.linkSelected" ng-show="linkOpts.linkSelected"><span>Back</span></div><div class="dz-modal-btn cancel" ng-click="show = false"><span>Close</span></div></div></div>',link:function(o,r,c){o.linkOpts={},o.modalAlert={},o.fbModalAlert={},o.loading={fb:!0},o.formData={linkType:"full"};var l=t.absUrl().replace(t.url(),""),d=function(e){return a.getSolrPrimaryImage(e)},u=function(t){if("undefined"!=typeof t){var i=e.findWhere(t.imageList,{_id:t.primaryImage});return"undefined"==typeof i?"/static/img/dz_disc.png":"/files/"+i.thumbnailId}},p=function(e){s.initFacebook().then(function(){s.scrapePath(e,function(e){i(function(){e?o.fbModalAlert.error={title:"Facebook Unavailable",message:"Facebook is unavailable at this time. Please try again.",show:!0}:o.facebookInit=!0,o.loading.fb=!1})})})},f=function(){o.isDisc?o.linkOpts.link=l+"/d/"+o.data.disc._id:o.isTrunk&&("base"==o.formData.linkType?o.linkOpts.link=l+"/t/"+o.data.user.username:"full"==o.formData.linkType&&(o.linkOpts.link=t.absUrl())),i(function(){document.getElementById("input-link").select()})};o.getDiscImage=function(t){if("undefined"!=typeof t)return e.isArray(t.imageList)?u(t):d(t)},o.getAccountImage=function(){return o.data.user?o.data.user.image:"/static/img/dz_profile.png"},o.shareFB=function(){o.isDisc?s.shareFacebook("/d/"+o.data.disc._id):o.isTrunk&&s.shareFacebook("/t/"+o.data.user._id)},o.showLink=function(){o.linkOpts.linkSelected=!0,f()},o.$watch("formData.linkType",function(e){"undefined"!=typeof e&&f()}),"undefined"!=typeof o.data.disc?(o.isDisc=!0,o.typeText="disc",o.modalAlert.info={title:"Note",message:"A shared link will be broken if this disc is marked private.",hideClose:!0,show:!0},p("/d/"+o.data.disc._id)):"undefined"!=typeof o.data.user&&(o.isOwner=n.compareTo(o.data.user._id),o.isTrunk=!0,o.typeText="trunk",o.isOwner&&(o.modalAlert.info={title:"Note",message:"Only your public discs will be visible when sharing your trunk.",hideClose:!0,show:!0}),p("/t/"+o.data.user.username))}}}]).directive("dzAcknowledgementModal",["DiscService",function(e){return{restrict:"E",scope:{data:"=data",show:"=",doOnClose:"="},replace:!0,template:'<div><div class="dz-modal-content"><i class="fa fa-5x fa-exclamation-triangle" style="color:#008EDD"></i><div class="dz-modal-title-lg">Warning!</div><div class="dz-modal-message" id="modal-message-1" ng-show="data.message1"></div><br><div class="dz-modal-message" id="modal-message-2" ng-show="data.message2"></div></div><div class="dz-modal-btn-container"><div class="dz-modal-triangle"></div><div class="dz-modal-btn cancel" ng-click="show = false">Cancel</div><div class="dz-modal-btn" ng-click="confirm()" style="background-color: #008EDD">OK</div></div></div>',link:function(e,t,i){"undefined"!=typeof e.data.message1&&(document.getElementById("modal-message-1").innerHTML=e.data.message1),"undefined"!=typeof e.data.message2&&(document.getElementById("modal-message-2").innerHTML=e.data.message2),e.confirm=function(){e.doOnClose=!0,e.show=!1}}}}]).directive("dzModalTable",["_","QueryService","CacheService",function(e,t,i){return{restrict:"E",scope:{successText:"=",defaultText:"=",tableOpts:"="},replace:!0,template:'<div class="dz-modal-table"><div class="dz-modal-row header"><div class="dz-modal-row-item">{{tableOpts.headerText}}</div><div class="dz-modal-row-item">Status</div><div class="clearfix"></div></div><div class="dz-modal-row" ng-repeat="item in tableOpts.items"><div class="dz-modal-row-item left handle-overflow" ng-if="tableOpts.isDisc"><img ng-src="{{getImage(item)}}" />{{item.brand}} {{item.name}}</div><div class="dz-modal-row-item handle-overflow"><span ng-if="tableOpts.isCounter && !tableOpts.isVisibility && !tableOpts.isMarketplace" directive-on="item.countdown.init" directive-set="{countdown:\'\'}" sec-left="item.countdown.bumpRemaining" counts="item.countdown.counts" done="item.countdown.bumpReady" show="item.countdown.show"><span ng-show="item.countdown.show && !item.countdown.bumpReady"><span ng-bind="item.countdown.counts.hours"></span> : <span ng-bind="item.countdown.counts.minutes"></span> : <span ng-bind="item.countdown.counts.seconds"></span></span><span ng-show="item.countdown.loading"><i class="fa fa-spinner fa-spin fa-lg"></i></span><span ng-show="item.countdown.bumpReady && !item.success" style="font-weight:bold;">{{tableOpts.defaultText}}</span><span ng-show="!item[\'marketplace.forSale\'] && !item[\'marketplace.forTrade\']" style="font-style:italic;">Not In Marketplace</span></span><span ng-if="!tableOpts.isCounter && tableOpts.isVisibility && !tableOpts.isMarketplace"><span ng-show="!item.success && !item.error" ng-class="{private: !item.visible}">{{item.visible ? \'Public\' : \'Private\'}}</span><span ng-show="item.success" ng-class="{private: !item.visible}"><i style="color:#4FC74F;" class="fa fa-check fa-tools" aria-hidden="true"></i>{{item.visible ? \'Public\' : \'Private\'}}</span><span ng-show="item.error"><i style="color:#E85947;" class="fa fa-times fa-tools" aria-hidden="true"></i>Error</span></span><span ng-if="!tableOpts.isCounter && !tableOpts.isVisibility && tableOpts.isMarketplace"><span ng-show="!item.success && !item.error && !item.ineligible"><i class="fa fa-usd market-icon" ng-class="{\'for-sale\':item[\'marketplace.forSale\']}"></i><i class="fa fa-exchange market-icon" ng-class="{\'for-trade\':item[\'marketplace.forTrade\']}"></i></span><span ng-show="item.success"><i style="color:#4FC74F;" class="fa fa-check fa-tools" aria-hidden="true"></i><i class="fa fa-usd market-icon" ng-class="{\'for-sale\':item[\'marketplace.forSale\']}"></i><i class="fa fa-exchange market-icon" ng-class="{\'for-trade\':item[\'marketplace.forTrade\']}"></i></span><span ng-show="item.error"><i style="color:#E85947;" class="fa fa-times fa-tools" aria-hidden="true"></i>Marketplace Cap Reached</span><span ng-show="item.ineligible"><i style="color:#E85947;" class="fa fa-times fa-tools" aria-hidden="true"></i>Ineligible For Marketplace</span></span><span ng-if="!tableOpts.isCounter && !tableOpts.isVisibility && !tableOpts.isMarketplace"><span ng-show="!item.success && !item.error">{{tableOpts.defaultText}}</span><span ng-show="item.success"><i style="color:#4FC74F;" class="fa fa-check fa-tools" aria-hidden="true"></i>{{tableOpts.successText}}</span><span ng-show="item.error"><i style="color:#E85947;" class="fa fa-times fa-tools" aria-hidden="true"></i>Error</span></span></div><div class="clearfix"></div></div></div>',link:function(a,n,s){var o=function(e){return t.getSolrPrimaryImage(e)},r=function(t){var i=e.findWhere(t.imageList,{_id:t.primaryImage});return"/files/"+i.thumbnailId};a.getImage=function(t){if(a.tableOpts.isDisc)return e.isArray(t.imageList)?r(t):o(t)},a.$watch("tableOpts.isCounter",function(t){"undefined"!=typeof t&&t===!0&&e.each(a.tableOpts.items,function(e){(e["marketplace.forSale"]||e["marketplace.forTrade"])&&(e.countdown={},e.countdown.loading=!0,i.getDisc(e._id,function(t,i){t?(e.countdown.bumpRemaining=i.marketplace.bumpRemaining,e.countdown.init=!0):e.error=!0,e.countdown.loading=!1}))})})}}}]).directive("ngEnter",["$timeout",function(e){return{restrict:"A",link:function(t,i,a){"undefined"!=typeof a.ngEnterLock&&i.bind("keydown",function(e){13!==e.which||e.shiftKey||e.preventDefault()}),i.bind("keyup",function(i){13!==i.which||i.shiftKey||(i.preventDefault(),i.stopImmediatePropagation(),e(function(){t.$eval(a.ngEnter),i.preventDefault()}))})}}}]).directive("ngModelEnter",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,i,a,n){i.bind("keyup",function(i){13!==i.which||i.shiftKey||(i.stopImmediatePropagation(),e(function(){n.$commitViewValue(),t.$eval(a.ngModelEnter),i.preventDefault()}))})}}}]).controller("MainController",["$rootScope","$scope","$location","AccountService","_","APIService","QueryService","SocketUtils","DiscService",function(e,t,i,a,n,s,o,r,c){t.pgSettings={hasFooter:!1,scrollLock:!1},t.nav=function(e,t){i.path("/"+(e?e:"")).search({}),t&&i.replace()},t.navExplore=function(e){i.path("/explore").search("q",e)},t.$def=function(e){return"undefined"!=typeof e},t.safeApply=function(e){if(this.$root&&this.$root.$$phase){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)}},t.containsStr=function(e,t){return n.contains(e,String(t))},t.getUserImage=function(e){return e.image?e.image:"/static/img/dz_profile.png"},t.getPrimaryImage=function(e){if(e.primaryImage){var t=n.findWhere(e.imageList,{_id:e.primaryImage});if(t)return"/files/"+t.fileId}return"/static/img/dz_disc.png"},t.log=function(e){console.log(e)},t.getSolrPrimaryImage=function(e){return o.getSolrPrimaryImage(e)},t.toggle=function(e){e=!e}}]).controller("PortalController",["$scope","$location","$window","$timeout","smoothScroll","PageUtils",function(e,t,i,a,n,s){var o,r=document.getElementById("explore-start");t.search({}),e.transform="rotate(0deg)",e.scrollPage=function(){var e={duration:700,easing:"easeInQuad",offset:50};n(r,e)};var c=function(){var t=Math.min(180,s.getScrollPos());t!=o&&(a(function(){e.transform="rotate("+t+"deg)"}),o=t)};angular.element(document).bind("scroll",c),e.$on("$destroy",function(){angular.element(document).unbind("scroll",c)})}]).controller("TrunksController",["$scope","$location","$routeParams","$window","_","$timeout","smoothScroll","QueryUserService","CacheService","AccountService","LocationService","PageUtils","PageCache",function(e,t,i,a,n,s,o,r,c,l,d,u,p){var f,g=!0,m=20,v=!1,h=!1;angular.element(document.getElementById("location-search")),document.getElementById("location-results");e.curUser=l.getAccount(),e.activeFilters=[],e.breadcrumbs=[],e.resultList=[],e.resultFilters=[],e.location={results:[],loading:!1,locSet:!1},e.globalModalOpts={},e.pagination={start:0,total:0},e.units="miles",e.statusHome="trunks",e.searchParam="",e.sortParam="rel",e.loading=!0,e.loadingMore=!1,e.itemSelected=function(){e.setLocation(e.location.results[e.location.selResult])};var b=function(){e.breadcrumbs=[],e.searchParam.length&&e.breadcrumbs.push({title:"Searching",links:[{text:'"'+e.searchParam+'"'}]}),e.geo&&e.geo.distance&&(e.breadcrumbs.push({title:"In",links:[{text:e.location.curLocation}]}),e.breadcrumbs.push({title:"Radius",links:[{text:e.geo.distance+" "+e.units,href:"/trunks?d="+e.geo.distance}]}));var i=[];n.each(e.activeFilters,function(a){var s={title:a.text,links:[]},o={name:a.name,fields:[]};i.push(o),n.each(a.fields,function(a){o.fields.push(a),s.links.push({text:"true"===a?"Active":a,href:t.path()+r.getQueryString({query:e.searchParam,sort:v?e.sortParam:void 0,locSet:e.location.locSet,filter:i,geo:e.geo})})}),e.breadcrumbs.push(s)})};e.loadMore=function(){if(!(e.loading||g||h)&&(h=!0,e.resultList.length<e.pagination.total)){var t=e.resultList.length;e.pagination.start=t,e.performSearch(!0)}},e.locationAllowed=function(){return d.isLocationAvailable()},e.hideLocResults=function(){s(function(){e.location.editable=!1,e.location.loading=!1,e.location.search="",e.location.selResult=-1},300)},e.setLocation=function(t){e.location.editable=!1,e.location.curLocation=t.address,e.geo||(e.geo={}),e.geo.latitude=t.latitude,e.geo.longitude=t.longitude,e.location.locSet=!0,e.updateUrl()},e.$watch("location.search",function(t){e.location.selResult=-1,t&&t.length>3?(e.location.loading=!0,d.getGeoLocation(t,function(t,i){t?(console.log(i),e.location.results=i,e.location.selResult=-1):e.location.results=[],e.location.loading=!1})):e.location.results=[]}),e.startSearch=function(){e.activeFilters=[],e.updateUrl()},e.isFilterActive=function(t,i){var a=n.find(e.activeFilters,{name:t.prop});return i.active=a&&e.containsStr(a.fields,i.val),i.active},e.hasActiveFilters=function(t){var i=n.find(e.activeFilters,{name:t.prop});return i&&i.fields.length},e.clearActiveFilters=function(t,i){e.activeFilters=n.filter(e.activeFilters,function(e){return e.name!=t.prop}),i||e.updateUrl()},e.toggleFilter=function(t,i){var a=n.find(e.activeFilters,{name:t.prop});a?e.containsStr(a.fields,i.val)?a.fields=n.without(a.fields,String(i.val)):a.fields.push(i.val):e.activeFilters.push({name:t.prop,text:t.text,fields:[i.val]}),e.activeFilters=n.filter(e.activeFilters,function(e){return e.fields.length>0}),e.updateUrl()},e.toggleVerification=function(t){e.toggleFilter(t,{val:!0})},e.isVerificationActive=function(t){return e.isFilterActive(t,{val:!0})},e.hasVerificationsActive=function(){var t=n.filter(e.activeFilters,function(t){return typeof("undefined"!==e.resultFilters.statFilters[t.name])});return t.length},e.clearActiveVerifications=function(){n.each(e.resultFilters.statFilters,function(t){e.clearActiveFilters(t,!0)}),e.updateUrl()},e.updateUrl=function(){e.pagination.start=0,t.url(t.path()+r.getQueryString({query:e.searchParam,sort:v?e.sortParam:void 0,filter:e.activeFilters,geo:e.geo,locSet:e.location.locSet}))},e.updateLocation=function(){e.geo&&e.geo.latitude&&e.geo.longitude?(e.location.loading=!0,d.getReverseGeo(e.geo.latitude,e.geo.longitude,function(t,i){t&&i.length?e.location.curLocation=i[0].address:e.location.curLocation="Unknown",e.location.loading=!1,b()})):(e.location.curLocation=void 0,b())},e.performSearch=function(t){t?e.loadingMore=!0:e.loading=!0;var i="undefined"!=typeof f&&!f.loaded;r.queryAll({query:e.searchParam,sort:e.sortParam,filter:e.activeFilters,start:i?0:e.pagination.start,limit:i?Math.max(f.loadCount,m):m,geo:e.geo},function(a,n){a&&(i&&(f.loaded=!0),e.pagination.start=n.start,e.pagination.total=n.total,console.log(n),t?Array.prototype.push.apply(e.resultList,n.results):(e.resultList=n.results,e.resultFilters=n.facets,console.log(e.resultFilters))),e.updateLocation(),e.loading=!1,e.loadingMore=!1,h=!1})},e.onLastUser=function(){e.resizeRes(function(){"undefined"==typeof f||f.scrolled||(window.scrollTo(0,f.scrollPos),f.scrolled=!0);var t=document.getElementById("results-list");u.getWindowHeight()>u.getFullHeight(t)&&e.pagination.total>e.resultList.length&&e.loadMore()})},e.resizeRes=function(e){var t=document.getElementById("results-container"),i=document.getElementById("results-list"),a=document.getElementById("result-header-static"),n=document.getElementById("result-header-fluid");s(function(){if(angular.element(i).css("width",206*Math.floor(t.clientWidth/206)+"px"),angular.element(n).css("padding-right",a.clientWidth+10+"px"),"function"==typeof e)return e()})},e.$on("$locationChangeStart",function(){p.setData({loadCount:e.resultList.length,routeTime:new Date,scrollPos:u.getScrollPos()})}),e.updateSort=function(){v=!0,e.updateUrl()},e.setProximity=function(t){t?e.geo&&(e.geo.distance=t.val):e.geo.distance=void 0,e.updateUrl()},e.isProximityActive=function(t){return t?e.geo&&e.geo.distance==t.val:e.geo&&e.geo.distance},e.$watch("fullscreen",function(t){s(function(){e.resizeRes()})}),e.getLocation=function(t){var i=t;"undefined"==typeof t&&e.geo&&e.geo.distance&&(i=e.geo.distance),d.getLocation(function(i,a){i?(e.geo={latitude:a.latitude,longitude:a.longitude,distance:t},e.location.locSet=!1):(e.geo={},e.location.locSet=!1,e.sortParam="rel"),e.performSearch()})},e.$watch(function(){return t.url()},function(i){if(i&&/^\/(trunks)/.test(i)){if(p.isNavBack()){var a=p.getPageData();a&&(f=a)}var n=r.parseUrlQuery(t.search()),s=n.geo&&"undefined"!=typeof n.geo.distance,o=n.geo&&n.geo.latitude&&n.geo.longitude;e.activeFilters=n.filters,e.searchParam=n.search,n.sort?e.sortParam=n.sort:n.search.length?e.sortParam="rel":s||o?e.sortParam="proximity":e.sortParam="rel",n.geo?n.geo.latitude&&n.geo.longitude?(e.geo={latitude:n.geo.latitude,longitude:n.geo.longitude,distance:n.geo.distance},e.location.locSet=!0,e.performSearch()):s&&e.getLocation(n.geo.distance):e.getLocation(void 0)}}),e.$on("$destroy",function(){angular.element(a).unbind("resize",e.resizeRes)}),angular.element(a).bind("resize",e.resizeRes),e.resizeRes(),g=!1}]).controller("ExploreController",["$scope","$location","$routeParams","$window","$q","_","$timeout","QueryService","CacheService","AccountService","DiscService","RedirectService","APIService","MembershipService","PageCache","PageUtils",function(e,t,i,a,n,s,o,r,c,l,d,u,p,f,g,m){var v,h=!0,b=!1,w=20,y=!1;e.view={},e.curUser=l.getAccount(),e.activeFilters=[],e.breadcrumbs=[],e.resultList=[],e.resultFilters=[],e.trunk={},e.globalModalOpts={},e.lbOpts={},e.alertOpts={},e.isOwnedTrunk=i.username&&e.curUser&&i.username===e.curUser.username,e.marketplace={forSale:!e.isOwnedTrunk,forTrade:!e.isOwnedTrunk,all:e.isOwnedTrunk},e.pagination={start:0,total:0},e.searchParam="",e.sortParam="createDate",e.loading=!0,e.loadingMore=!1,e.msOpts={active:!1,count:0,showIneligible:!1,showNoCount:!1};var k=function(t){e.loadMore(e.pagination.total,function(){if(w=20,t)return t()})};e.shareTrunk=function(){e.globalModalOpts={type:"dz-share-modal",show:!0,data:{user:e.trunk.user}}},e.msOpts.showMsHelp=function(){e.globalModalOpts={type:"dz-info-modal",show:!0,data:{title:"Multi-select Toolbox Help",body:'<div class="dz-info-table"><table><tbody><tr class="header-row"><th>Icon</th><th>Feature</th><th>Description</th></tr><tr><td class="ms-help-icon"><i class="fa fa-lg fa-eye"></i></td><td class="ms-help-label">Visibility</td><td class="ms-help-text">Use the visibility function to simultaneously set the visibility parameter of all selected discs.</td></tr><tr><td class="ms-help-icon"><i class="fa fa-lg fa-usd"></i></td><td class="ms-help-label">Marketplace</td><td class="ms-help-text">Use the marketplace function to manage the for sale/trade status of all selected discs.<br><br><span>Requires Entrepreneur <a href="/account/membership/" class="dz-blue hover-underline">account</a> or higher.</span></td></tr><tr><td class="ms-help-icon"><i class="fa fa-lg fa-sort-amount-desc fa-flip-vertical"></i></td><td class="ms-help-label">Bump</td><td class="ms-help-text">Use the bump function to quickly bump all available discs within your selection.<br><br><span>Requires Chief Executive <a href="/account/membership/" class="dz-blue hover-underline">account</a>.</span></td></tr><tr><td class="ms-help-icon"><i class="fa fa-lg fa-tags"></i></td><td class="ms-help-label">Tags</td><td class="ms-help-text">Use the tag function to conveniently manage shared tags across all selected discs.<br><br><span>Requires Entrepreneur <a href="/account/membership/" class="dz-blue hover-underline">account</a> or higher.</span></td></tr><tr><td class="ms-help-icon"><i class="fa fa-lg fa-trash"></i></td><td class="ms-help-label">Delete</td><td class="ms-help-text">Use the delete function to quickly delete all selected discs.</td></tr><tr><td class="ms-help-icon"><i class="fa fa-lg fa-object-group"></i></td><td class="ms-help-label">Select All</td><td class="ms-help-text">Use the select all function to load and select all discs within the current filter settings.<br><br><span>Requires Chief Executive <a href="/account/membership/" class="dz-blue hover-underline">account</a>.</span></td></tr><tr><td class="ms-help-icon"><i class="fa fa-lg fa-object-ungroup"></i></td><td class="ms-help-label">Deselect All</td><td class="ms-help-text">Use the deselect all function clear all selected discs from the multi-select tool.<br><br><span>Requires Chief Executive <a href="/account/membership/" class="dz-blue hover-underline">account</a>.</span></td></tr></tbody></table></div>'}}},e.hasMsPermission=function(t){if(e.curUser)return f.hasPermission(t,e.curUser.accountType)},e.msOpts.selectAll=function(){e.msOpts.count=0,k(function(){o(function(){s.each(e.resultList,function(t){t.selected=!0,e.msOpts.count+=1})})})},e.msOpts.deselectAll=function(){e.msOpts.count=0;var t=s.where(e.resultList,{selected:!0});s.each(t,function(e){e.selected=!1})},e.msOpts.setVisibility=function(){var t=s.where(e.resultList,{selected:!0});t.length&&(e.globalModalOpts={type:"dz-visibility-modal",show:!0,data:{discs:t,onClose:function(t){t&&e.handleUrl()}}})},e.msOpts.setMarketplace=function(){var t=s.where(e.resultList,{selected:!0}),i=!1;s.each(t,function(e){"undefined"!=typeof e["imageList.0._id"]&&e.visible||(e.ineligible=!0,i=!0)}),t.length&&(e.globalModalOpts={type:"dz-marketplace-modal",show:!0,data:{isIneligible:i,marketData:e.marketData,discs:t,onClose:function(t){t&&e.handleUrl()}}})},e.msOpts.bumpDiscs=function(){var t=s.where(e.resultList,{selected:!0});t.length&&(e.globalModalOpts={type:"dz-bump-modal",show:!0,data:{discs:t,onClose:function(t){t&&e.handleUrl()}}})},e.msOpts.manageTags=function(){var t=s.where(e.resultList,{selected:!0});t.length&&(e.globalModalOpts={type:"dz-tag-modal",show:!0,data:{discs:t,user:e.trunk.user._id,onClose:function(t){t&&e.handleUrl()}}})},e.msOpts.deleteDiscs=function(){var t=s.where(e.resultList,{selected:!0});t.length&&(e.globalModalOpts={type:"dz-delete-disc-modal",show:!0,data:{discs:t,onClose:function(t){t&&e.handleUrl()}}})},e.msOpts.toggleMS=function(){e.msOpts.active=!e.msOpts.active,e.msOpts.active||e.msOpts.deselectAll()},e.msOpts.toggleSelected=function(t){t.selected=!t.selected,t.selected?e.msOpts.count+=1:e.msOpts.count-=1};var x=function(e){var t=e.match(/\[(\d+)\s?TO\s?(\d+|\*)\]/);return 3!=t.length?e:"$"+t[1]+("*"===t[2]?"+":" - $"+t[2])},A=function(){e.breadcrumbs=[],e.searchParam.length&&e.breadcrumbs.push({title:"Searching",links:[{text:'"'+e.searchParam+'"'}]}),e.breadcrumbs.push({title:"Showing",links:[{text:e.marketplace.forSale?e.marketplace.forTrade?"For Sale and Trade":"For Sale":e.marketplace.forTrade?"For Trade":"All Discs"}]}),"undefined"!=typeof e.view.visible&&e.breadcrumbs.push({title:"Displaying",links:[{text:e.view.visible?"Public Only":"Private Only"}]});var i=[];s.each(e.activeFilters,function(a){var n={title:a.text,links:[]},o={name:a.name,fields:[]};i.push(o),s.each(a.fields,function(a){var s=a;/\[\d+\s?TO\s?(?:\d+|\*)\]/.test(a)&&(s=x(a)),o.fields.push(a),n.links.push({text:s,href:t.path()+r.getQueryString({query:e.searchParam,sort:b?e.sortParam:void 0,filter:i,
marketplace:e.marketplace,visible:e.view.visible})})}),e.breadcrumbs.push(n)})};e.loadMore=function(t,i){if(!(e.loading||h||y))if(y=!0,e.resultList.length<e.pagination.total){var a=e.resultList.length;t&&(w=Math.min(e.pagination.total,t)-a),e.pagination.start=a,e.performSearch(!0,i)}else y=!1,i&&i()},e.getVisibleTitle=function(){return"undefined"==typeof e.view.visible?"Displaying All":e.view.visible?"Displaying Public":"Displaying Private"},e.toggleVisibillty=function(){"undefined"==typeof e.view.visible?e.view.visible=!0:e.view.visible?e.view.visible=!1:e.view.visible=void 0,e.updateUrl()},e.startSearch=function(){e.activeFilters=[],e.updateUrl()},e.updateUrl=function(){e.pagination.start=0,t.url(t.path()+r.getQueryString({query:e.searchParam,sort:b?e.sortParam:void 0,filter:e.activeFilters,marketplace:e.marketplace,visible:e.view.visible}))},e.marketMode=function(){return e.marketplace.forSale||e.marketplace.forTrade};var z=function(t){for(var i in t){var a=t[i];a.open=!0;for(var n=0;n<a.filters.length;n++)n==a.filters.length-1?(a.filters[n].text="$"+a.filters[n].val+"+",a.filters[n].val="["+a.filters[n].val+" TO *]"):(a.filters[n].text="$"+a.filters[n].val+" - $"+a.filters[n+1].val,a.filters[n].val="["+a.filters[n].val+" TO "+a.filters[n+1].val+"]");var o=s.findWhere(e.activeFilters,{name:i});if(o)for(var n=0;n<o.fields.length;n++)if(r.isCustomRange(o.fields[n])){var c=o.fields[n].match(/^\[(\d+) TO (\d+)\]$/);if(c.length>2){a.custom={enable:!0,lBound:parseInt(c[1]),uBound:parseInt(c[2])};break}}}};e.performSearch=function(t,i){t?e.loadingMore=!0:e.loading=!0;var a="undefined"!=typeof v&&!v.loaded;r.queryAll({query:e.searchParam,sort:e.sortParam,filter:e.activeFilters,start:a?0:e.pagination.start,valueRange:!0,limit:a?Math.max(v.loadCount,w):w,marketplace:e.marketplace,userId:e.trunk.userId||void 0,visible:e.view.visible},function(n,o){if(n){if(a&&(v.loaded=!0),e.pagination.start=o.start,e.pagination.total=o.total,console.log(o),t)Array.prototype.push.apply(e.resultList,o.results);else{e.resultList=o.results,z(o.facets.rangeFilters);var r=0;for(var c in o.facets){var l=o.facets[c];for(var d in l){var u=l[d];if(u.filters.length){r<4&&(u.open=!0);var p=5,f=s.find(e.activeFilters,{name:d});f&&s.each(f.fields,function(e){p=Math.max(p,s.findIndex(u.filters,function(t){return t.val==e})+1)}),u.limit=p,r++}}}e.resultFilters=o.facets,y=!1,console.log(e.resultFilters)}e.getUsers()}i&&i(),e.loading=!1,e.loadingMore=!1})},e.resultOrder=function(e){return-1*(e.count+(e.active?.5:0))},e.getUsers=function(){var t=s.groupBy(e.resultList,"userId");for(var i in t)c.getUser(i,function(e,i){e&&s.each(t[i._id],function(e){e.user=i})})},e.onLastDisc=function(){e.resizeRes(function(){"undefined"==typeof v||v.scrolled||(window.scrollTo(0,v.scrollPos),v.scrolled=!0);var t=document.getElementById("results-list");m.getWindowHeight()>m.getFullHeight(t)&&e.pagination.total>e.resultList.length&&e.loadMore()})},e.resizeRes=function(e){var t=document.getElementById("results-container"),i=document.getElementById("results-list"),a=document.getElementById("result-header-static"),n=document.getElementById("result-header-fluid");o(function(){if(angular.element(i).css("width",206*Math.floor(t.clientWidth/206)+"px"),angular.element(n).css("padding-right",a.clientWidth+10+"px"),"function"==typeof e)return e()})},e.isFilterActive=function(t,i){var a=s.find(e.activeFilters,{name:t.prop});return i.active=a&&e.containsStr(a.fields,i.val),i.active},e.isMarketplaceModeActive=function(t){return e.marketplace[t]},e.hasActiveFilters=function(t){var i=s.find(e.activeFilters,{name:t.prop});return i&&i.fields.length},e.clearActiveFilters=function(t,i){e.activeFilters=s.filter(e.activeFilters,function(e){return e.name!=t.prop}),i||e.updateUrl()},e.getFacets=function(){r.queryFacet({query:e.searchParam,sort:e.sortParam,filter:e.activeFilters,userId:e.trunk.userId||void 0,marketplace:e.marketplace,visible:e.view.visible,facet:{name:"tag",limit:2,offset:2}},function(e,t){e&&console.log(t)})},e.updateSort=function(){b=!0,e.updateUrl()},e.$watch("fullscreen",function(t){o(function(){e.resizeRes()})}),e.$on("$locationChangeStart",function(){g.setData({loadCount:e.resultList.length,routeTime:new Date,scrollPos:m.getScrollPos()})}),e.handleUrl=function(){var i=r.parseUrlQuery(t.search()),a=!1;e.activeFilters=i.filters,e.searchParam=i.search,i.mode&&(e.marketplace={forSale:"all-market"==i.mode||"sale"==i.mode,forTrade:"all-market"==i.mode||"trade"==i.mode,all:"all"==i.mode}),a=e.marketplace.forSale||e.marketplace.forTrade,i.sort?"new"==i.sort&&!a||"modDate"==i.sort&&!e.isOwnedTrunk||(e.sortParam=i.sort):i.search.length?e.sortParam="rel":a?e.sortParam="new":e.sortParam="createDate","undefined"!=typeof i.visible&&e.isOwnedTrunk&&(e.view.visible=i.visible),A(),e.msOpts&&e.msOpts.active&&e.msOpts.toggleMS(),h||e.performSearch()};var $=function(){e.$watch(function(){return t.url()},function(i){var i=t.url();if(i&&/^\/(t\/|explore)/.test(i)){if(g.isNavBack()){var a=g.getPageData();a&&(v=a)}e.handleUrl()}})};e.toggleFilter=function(t,i){var a=s.find(e.activeFilters,{name:t.prop});a?e.containsStr(a.fields,i.val)?a.fields=s.without(a.fields,String(i.val)):a.fields.push(i.val):e.activeFilters.push({name:t.prop,text:t.text,fields:[i.val]}),e.activeFilters=s.filter(e.activeFilters,function(e){return e.fields.length>0}),e.updateUrl()},e.toggleMarketplaceMode=function(t){switch(t){case"forSale":e.marketplace.forSale&&!e.marketplace.forTrade?e.marketplace.all=!0:e.marketplace.all=!1;break;case"forTrade":e.marketplace.forTrade&&!e.marketplace.forSale?e.marketplace.all=!0:e.marketplace.all=!1;break;case"all":if(e.marketplace.all)return;e.marketplace.forTrade=!1,e.marketplace.forSale=!1}e.marketplace[t]=!e.marketplace[t],e.updateUrl()},angular.element(a).bind("resize",e.resizeRes),e.$on("$destroy",function(){angular.element(a).unbind("resize",e.resizeRes)}),i.username?c.getUserByUsername(i.username,function(t,i){return t?(e.trunk.userId=i._id,e.trunk.user=i,e.statusHome="t/"+i.username,l.getAccountMarket(function(t,i){return t?(e.marketData=i,void(e.marketData.accountName=f.getAccountName(e.curUser.accountType))):u.setRedirect("explore")}),h=!1,void $()):u.setRedirect("explore")}):(h=!1,e.statusHome="explore",$()),e.resizeRes()}]).controller("RedirectController",["$scope","$timeout","RedirectService","$location",function(e,t,i,a){t(function(){a.path("/"+i.getRedirectPath()).replace()},1e3)}]).controller("DiscController",["$scope","$location","$routeParams","$timeout","$window","_","RedirectService","CacheService","AccountService","DiscService","MessageService",function(e,t,i,a,n,s,o,r,c,l,d){var u=i.discId;t.search({}),e.breadcrumbs=[],e.bumpReady=!1,e.isSaving=!1,e.loading={disc:!0,privacy:!1},e.tempMarketplace={},e.discAlert={},e.marketAlert={},e.globalModalOpts={};var p=function(){e.breadcrumbs=[{title:"Trunk",links:[{text:e.user.username,href:"/t/"+e.user.username}]},{title:"Disc",links:[{text:e.disc.brand+" "+e.disc.name}]}],e.userInit=!0},f=function(){c.getAccountMarket(function(t,i){t?e.tempMarketplace.counts=i:e.marketAlert.error={title:i.type,message:i.message,show:!0}})},g=function(t){e.tempMarketplace.forSale=t.marketplace.forSale,e.tempMarketplace.forTrade=t.marketplace.forTrade,f()};e.shareDisc=function(){e.globalModalOpts={type:"dz-share-modal",show:!0,data:{disc:e.disc}}},e.deleteDisc=function(){var i=[e.disc];e.globalModalOpts={type:"dz-delete-disc-modal",show:!0,data:{discs:i,onClose:function(i){i&&t.url("/t/"+e.user.username)}}}},e.bumpDisc=function(){l.bumpDisc(e.disc._id,function(t,i){t?(e.disc=i,g(i),e.bumpReady=!1):e.marketAlert.error={title:i.type,message:i.message,show:!0}})},e.saveDisc=function(){e.isSaving=!0;var t={_id:e.disc._id,marketplace:{forSale:e.tempMarketplace.forSale,forTrade:e.tempMarketplace.forTrade}};l.editDisc(t,function(t,i){t?(e.disc=i,e.bumpReady=0===i.marketplace.bumpRemaining,g(i),e.marketAlert.success={title:"Success",message:"Marketplace options have been updated successfully.",show:!0,timeout:3e3}):e.marketAlert.error={title:"Error",message:"Unable to update marketplace options.",show:!0},e.isSaving=!1})},e.warnPrivacy=function(){e.isMarket()?e.globalModalOpts={type:"dz-acknowledgement-modal",show:!0,data:{message1:"This disc is currently on the marketplace, and making it private will automatically remove it from the marketplace. Do you wish to proceed?",onClose:function(t){t&&e.togglePrivacy()}}}:e.togglePrivacy()},e.togglePrivacy=function(){e.loading.privacy=!0;var t={_id:e.disc._id,visible:!e.disc.visible};l.editDisc(t,function(t,i){a(function(){t?(e.disc=i,g(i)):e.discAlert.error={title:"Error",message:"Unable to update disc visibility.",show:!0},e.loading.privacy=!1})})},e.initMessage=function(){d.setAttachment(d.TypeDisc,e.disc._id),t.path("/inbox").search("userId",e.user._id)},e.setImage=function(t){e.imageBlock=t},e.isMarket=function(){if("undefined"!=typeof e.disc)return e.disc.marketplace.forSale||e.disc.marketplace.forTrade},e.isMarketInvalid=function(){return!e.disc||!e.tempMarketplace.counts||!e.isMarket()&&0===e.tempMarketplace.counts.marketAvailable||!e.disc.visible||!e.disc.primaryImage},e.isDirty=function(){return e.tempMarketplace.forSale!=e.disc.marketplace.forSale||e.tempMarketplace.forTrade!=e.disc.marketplace.forTrade},e.givePermission=function(){return c.compareTo(e.disc.userId)},r.getDisc(u,function(t,i){return t?(e.disc=i,e.imageBlock=s.findWhere(i.imageList,{_id:i.primaryImage}),e.discInit=!0,e.givePermission()?(e.user=c.getAccount(),g(i),p()):r.getUser(i.userId,function(t,i){return t?(e.user=i,e.publicMode=!0,void p()):e.nav()}),void(e.loading.disc=!1)):o.setRedirect("explore")})}]).controller("DiscTemplateController",["$scope","$window","$location","$routeParams","$timeout","_","AccountService","APIService",function(e,t,i,a,n,s,o,r){if(!o.isLoggedIn()){var c=i.path();return i.path("/login").search("redirect",c)}i.search({}),e.templates=[],e.loading=!1,e.$watch("query",function(t){return"undefined"==typeof t||""==t?e.templates=[]:(e.loading=!0,void r.Get("/templates?q="+t,function(t,i){var a=[];if(t){var n=s.groupBy(i,"textSearch");for(var o in n)a.push({fullName:o,name:n[o][0].name,brand:n[o][0].brand,templates:n[o]})}e.templates=s.sortBy(a,"fullName"),e.loading=!1}))}),e.showVowel=function(){return e.query&&/[aeiou]/i.test(e.query.charAt(0))},e.resizeRes=function(){var e=document.getElementById("results-container"),t=document.getElementById("results-list");n(function(){angular.element(t).css("width",208*Math.floor(e.clientWidth/208)+"px")})},angular.element(t).bind("resize",e.resizeRes),e.$on("$destroy",function(){angular.element(t).unbind("resize",e.resizeRes)}),e.resizeRes()}]).controller("ModifyDiscController",["$compile","$scope","$routeParams","$location","$timeout","_","smoothScroll","$ocLazyLoad","APIService","CacheService","ImageService","AccountService","DiscService","RedirectService",function(e,t,i,a,n,s,o,r,c,l,d,u,p,f){if(!u.isLoggedIn()){var g=a.path();return a.path("/login").search("redirect",g)}var m=i.discId,v=i.templateId,h=document.getElementById("page-top"),b='<div class="image-item-container image-template"><div class="image-item"><div class="image-entity"><img data-dz-thumbnail /></div><div class="image-progress" data-dz-uploadprogress></div><div class="image-overlay"><span class="image-remove" data-dz-remove><i class="fa fa-times fa-lg"></i></span><div class="image-title handle-overflow"><span data-dz-name></span></div><div class="image-size handle-overflow" data-dz-size></div></div></div></div>',w=[];t.editAlert={},t.account=u.getAccount(),t.showGeneralHelp=function(){t.globalModalOpts={type:"dz-info-modal",show:!0,data:{title:"Modify Disc Help - General",body:'<div class="dz-info-table"><table><tbody><tr class="header-row"><th>Field</th><th>Description</th><th>Example</th></tr><tr><td class="help-label">Brand</td><td class="help-text">Enter the brand of the disc. (This field is required)</td><td class="help-ex">Innova</td></tr><tr><td class="help-label">Name</td><td class="help-text">Enter the name/mold of the disc. (This field is required)</td><td class="help-ex">Destroyer</td></tr><tr><td class="help-label">Type</td><td class="help-text">Select the type of the disc.</td><td class="help-ex">Distance Driver</td></tr><tr><td class="help-label">Material</td><td class="help-text">Enter the material of the disc. Most brands have at least 3 distinct material types.</td><td class="help-ex">Champion</td></tr><tr><td class="help-label">Weight</td><td class="help-text">Enter the weight of the disc in grams. The weight is frequently printed or written on the underside of the flight plate. <b>NOTE: </b>This field only accepts positive integers with up to 3 digits, and weights typically range from 150 to 180.</td><td class="help-ex">172</td></tr><tr><td class="help-label">Color</td><td class="help-text">Enter the color of the disc.</td><td class="help-ex">Orange</td></tr></tbody></table></div>'}}},t.showAdvancedHelp=function(){t.globalModalOpts={type:"dz-info-modal",show:!0,data:{title:"Modify Disc Help - Advanced",body:'<div class="dz-info-table"><table><tbody><tr class="header-row"><th>Field</th><th>Description</th><th>Example</th></tr><tr><td class="help-label">Speed</td><td class="help-text">Enter the speed of the disc. Speed is the first of four flight numbers, and it relates to the speed at which the disc must be thrown to achieve the designed flight path. <b>NOTE: </b>This field only accepts positive numbers with up to 2 digits and 1 decimal place. Speed values typically range from 1 to 15.</td><td class="help-ex">12</td></tr><tr><td class="help-label">Glide</td><td class="help-text">Enter the glide of the disc. Glide is the second of four flight numbers, and it relates to the disc\'s ability to stay afloat during it\'s flight. <b>NOTE: </b>This field only accepts positive numbers with up to 2 digits and 1 decimal place. Glide values typically range from 1 to 7.</td><td class="help-ex">5</td></tr><tr><td class="help-label">Turn</td><td class="help-text">Enter the turn of the disc. Turn is the third of four flight numbers, and it relates to the disc\'s resistance to turning during the high speed portion of it\'s flight. <b>NOTE: </b>This field only accepts positive and negative numbers with up to 2 digits and 1 decimal place. Turn values typically range from -5 to 1.</td><td class="help-ex">-1</td></tr><tr><td class="help-label">Fade</td><td class="help-text">Enter the fade of the disc. Fade is the fourth of four flight numbers, and it relates to the disc\'s resistance to turning during the low speed portion of it\'s flight. <b>NOTE: </b>This field only accepts positive and negative numbers with up to 2 digits and 1 decimal place. Fade values typically range from 0 to 6.</td><td class="help-ex">3</td></tr><tr><td class="help-label">Tags</td><td class="help-text">Enter tags that you associate with this disc. Use tags to group discs outside of inherent traits such as brand, material, color, etc. Tags are great ways to associate discs with specific collections, bags, or tournaments. They are completely customizable, and examples include "Thrower", "CFR", "Glow", "xxx Collection", "xxx Bag", etc. <b>NOTE: </b>A disc can have multiple tags, and a tag can be associated with multiple discs.</td><td class="help-ex">Thrower<br>Glow Bag<br>Zone Collection</td></tr><tr><td class="help-label">Notes</td><td class="help-text">Use the notes area to store detailed comments related to this disc only. Notes are completely customizable and examples may include "Found on hole 7 at...", "Won at...", "2008 World Championship stamp", "Only 1000 made", "Price includes shipping", etc.</td><td class="help-ex"></td></tr><tr><td class="help-label">Public</td><td class="help-text">Toggle the visibility setting to allow or prevent other users from viewing your disc. If public mode is turned on, then your disc is visible to the public and can be shared via Facebook or public URL. If public mode is turned off, then your disc is only privately viewable by the creator and shareable links will not work. <b>NOTE: </b>Visibility is saved for each disc independently and it can be toggled directly from the disc page by clicking on the eyeball icon. Each disc must be marked \'Public\' before adding it to the marketplace.</td><td class="help-ex"></td></tr><tr><td class="help-label">Condition</td><td class="help-text">Enter the condition of the disc based on the sleepy scale. <b>NOTE: </b>This field only accepts integers from 0 to 10.</td><td class="help-ex">9</td></tr></tbody></table></div>'}}},t.clearForm=function(e){t.disc={_id:t.disc._id,visible:!0,tagList:[],imageList:[]},t.discForm.$setPristine(),e||(t.editAlert={})},t.currentTagDrag={accept:function(e,t){return e.itemScope.sortableScope.$id===t.$id}},t.currentImageDrag={accept:function(e,t){return e.itemScope.sortableScope.$id===t.$id}},t.disc={_id:m,visible:!0,tagList:[],imageList:[]},t.settings={discReady:!1,dropzoneReady:!1,dropzoneProcessing:!1};var y=function(e){d.getDataUri(e,function(i){t.discImageCropper.showCropper(e.name,i)})},k=function(e){return e?(w.push(e),void(1==w.length&&y(e))):void(w.length&&y(w[0]))};t.dropzoneConfig={options:{url:"/api/images",method:"POST",thumbnailWidth:100,thumbnailHeight:100,parallelUploads:5,maxFiles:5,paramName:"discImage",previewTemplate:b,acceptedFiles:"image/*",autoProcessQueue:!0,previewsContainer:"#dropzone-previews",clickable:"#add-image",accept:function(i,a){return null!=this.files[5]?this.removeFile(this.files[5]):i.cropped||i.width<200?(n(function(){t.discImageCropper.cropperLoading=!1,t.settings.dropzoneProcessing=!0,i.previewElement.setAttribute("dropzone-preview",""),e(angular.element(i.previewElement))(t)}),a()):(n(function(){t.discImageCropper.cropperLoading=!0}),t.dropzoneConfig.getDropzone().removeFile(i),k(i),a("Processing"))},success:function(e,i){"undefined"!=typeof i._id&&(t.disc.imageList.push(i),1==t.disc.imageList.length&&(t.disc.primaryImage=i._id),t.safeApply()),this.removeFile(e)},queuecomplete:function(){n(function(){t.settings.dropzoneProcessing=!1})}}},t.discImageCropper={onFinish:function(e){t.safeApply(function(){t.discImageCropper.cropperLoading=!1}),e&&t.dropzoneConfig.getDropzone().addFile(e),w.shift(),k()},cropperLoading:!1},t.triggerDropzone=function(){t.dropzoneConfig.getDropzone().progTrigger()},t.removeImage=function(e){var i=t.disc.imageList.splice(e,1)[0];i._id==t.disc.primaryImage&&(t.disc.primaryImage=t.disc.imageList.length?t.disc.imageList[0]._id:void 0)},t.removeTag=function(e){t.disc.tagList.splice(e,1)[0]},t.pushTempTag=function(){t.tempTag&&t.tempTag.length&&!s.contains(t.disc.tagList,t.tempTag)?(t.disc.tagList.push(t.tempTag),t.tempTag=""):t.tempTag=""};var x=function(){var e={duration:300,easing:"easeInQuad"};o(h,e)};t.refreshMarket=function(){t.marketLoading=!0,u.getAccountMarket(function(e,i){e?t.market=i:t.editAlert.error={title:i.type,message:i.message,show:!0},t.marketLoading=!1})},t.submitDisc=function(){if(t.discForm.$invalid){for(var e in t.discForm.$error)angular.forEach(t.discForm.$error[e],function(e){e.$setDirty()});return t.editAlert.error={title:"Invalid Input",message:"Please correct any invalid fields and try again.",show:!0},void x()}return t.disc.visible&&0!==t.disc.imageList.length||!t.disc.marketplace||!t.disc.marketplace.forSale&&!t.disc.marketplace.forTrade?(t.marketError=!1,void(t.disc._id?p.editDisc(t.disc,function(e,i){e?(t.disc=i,t.breadcrumbs.splice(1,1,{title:"Disc",links:[{text:i.brand+" "+i.name+" (#"+m+")",href:"/d/"+m}]}),t.editAlert.success={title:"Success",message:{smartConfig:{text:"<!"+i.brand+" "+i.name+"> has been updated successfully.",links:["/d/"+i._id]}},show:!0},x(),t.discForm.$setPristine(),t.refreshMarket()):(t.editAlert.error={title:"Error",message:"Unable to update disc. "+i.type+": "+i.message,show:!0},x())}):p.createDisc(t.disc,function(e,i){e?(t.editAlert.success={title:"Success",message:{smartConfig:{text:"<!"+i.brand+" "+i.name+"> has been created successfully.",links:["/d/"+i._id]}},show:!0},x(),t.clearForm(!0),t.refreshMarket()):(t.editAlert.error={title:i.type,message:i.message,show:!0},x())}))):void(t.marketError=!0)},"undefined"==typeof Dropzone||"undefined"==typeof EXIF||"undefined"==typeof Cropper?r.load(["https://cdn.rawgit.com/exif-js/exif-js/master/exif.js","/static/src/js-dist/dropzone.min.js"]).then(function(){r.load(["/static/src/js-dist/cropper.min.js",{type:"css",path:"https://cdn.rawgit.com/fengyuanchen/cropperjs/master/dist/cropper.min.css"}]).then(function(){t.settings.dropzoneReady=!0})}):t.settings.dropzoneReady=!0,t.breadcrumbs=[{title:"Trunk",links:[{text:t.account.username,href:"/t/"+t.account.username}]}],"undefined"!=typeof m?l.getDisc(m,function(e,i){return e&&u.compareTo(i.userId)?(t.disc=i,t.isMarket=i.marketplace.forSale||i.marketplace.forTrade,t.breadcrumbs.push({title:"Disc",links:[{text:i.brand+" "+i.name+" (#"+m+")",href:"/d/"+m}]}),t.breadcrumbs.push({links:[{text:"Edit Disc"}]}),void(t.settings.discReady=!0)):f.setRedirect("explore")}):(t.breadcrumbs.push({links:[{text:"Create Disc"}]}),"undefined"!=typeof v?c.Get("/templates/"+v,function(e,i){e&&(t.disc={brand:i.brand,name:i.name,type:i.type,material:i.material,speed:i.speed,glide:i.glide,turn:i.turn,fade:i.fade,visible:!0,tagList:[],imageList:[]},t.editAlert.info={title:"Template Applied",message:"The selected template was applied to the form.",show:!0}),t.settings.discReady=!0}):t.settings.discReady=!0),t.refreshMarket()}]).controller("NewsfeedController",["$scope","$location","DataService",function(e,t,i){}]).controller("DashboardController",["$scope","$location","DataService",function(e,t,i){}]).controller("MessageController",["$scope","$location","$timeout","$q","_","smoothScroll","APIService","AccountService","SocketUtils","PageUtils","CacheService","Random","MessageService",function(e,t,i,a,n,s,o,r,c,l,d,u,p){if(!r.isLoggedIn()){var f=t.path();return t.path("/login").search("redirect",f)}var g,m=angular.element(document.getElementById("message-text-area")),v=document.getElementById("message-list");e.page={threadLimit:10,aThreadLimit:10},e.init=!1,e.account=r.getAccount(),e.messageThreads=[],e.archivedThreads=[],e.activeThread=void 0,e.sendOnEnter=!0,e.messageAlert={},e.breadcrumbs=[{links:[{text:"My Account",href:"/account"}]},{links:[{text:"Inbox"}]}],e.scrollBottom=function(){var e=angular.element(v)[0].querySelector(".message-item:last-child"),t={duration:700,easing:"easeInQuad",containerId:"message-list"};i(function(){s(e,t),m[0].focus()})};var h=function(){i(function(){var e=document.getElementById("inbox-area"),t=document.getElementById("footer-bar"),i=l.getWindowHeight(),a=l.getTop(e);angular.element(e).css("height",i-a-40-t.clientHeight+"px")})},b=function(e,t){e.messageCount=t.messageCount,e.currentMessageCount=t.currentMessageCount,e.modifiedDate=t.modifiedDate},w=function(t){var i=n.find(t.users,function(t){return t!=e.account._id});d.getUser(i,function(e,i){e&&i.image&&(t.image=i.image,t.user=i,t.imgInit=!0)})},y=function(t,i){o.Get("/threads/"+t,function(t,a){if(t){if(a.active){var s=n.findIndex(e.messageThreads,function(e){return e.threadId==a.threadId});s>-1?b(e.messageThreads[s],a):(a.messages=[],e.messageThreads.push(a),w(a)),s=n.findIndex(e.archivedThreads,function(e){return e.threadId==a.threadId}),s>-1&&e.activeThread==e.archivedThreads[s]&&e.archivedThreads.splice(s,1)}else{var s=n.findIndex(e.archivedThreads,function(e){return e.threadId==a.threadId});s>-1?b(e.archivedThreads[s],a):(a.messages=[],e.archivedThreads.push(a),w(a)),s=n.findIndex(e.messageThreads,function(e){return e.threadId==a.threadId}),s>-1&&e.messageThreads.splice(s,1)}i&&e.activateThread(a)}else e.messageAlert.error={title:a.type,message:"Unable to reload message thread. "+a.message,show:!0}})},k=function(t){n.each(t,function(t){t.messages=[],g&&t.threadId==g&&(e.activeThread=t,e.getMessages(!0)),w(t)})},x=function(t){t.currentMessageCount!=t.messageCount&&o.Put("/threads/"+t.threadId,{messageCount:t.currentMessageCount},function(i,a){i?b(t,a):e.messageAlert.error={title:t.type,message:"Unable to update message thread. "+t.message,show:!0}})},A=function(e){return k([e])},z=function(t){i(function(){if(e.activeThread&&e.activeThread.threadId==t.threadId&&e.activeThread.active)e.activeThread.messages.push(t),e.activeThread.currentMessageCount++,x(e.activeThread);else{var i=n.findWhere(e.messageThreads,{threadId:t.threadId});"undefined"!=typeof i?(i.messages.length&&i.messages.push(t),i.currentMessageCount++):y(t.threadId)}})},$=function(){return"?count=20"+(e.activeThread.refId?"&refId="+e.activeThread.refId:"")};e.toggleSend=function(){e.sendOnEnter=!e.sendOnEnter},e.unarchiveThread=function(){e.activeThread&&o.Put("/threads/"+e.activeThread.threadId,{active:!0},function(i,a){if(i){var s=n.findIndex(e.archivedThreads,function(e){return e._id==a._id});s>-1?(e.archivedThreads.splice(s,1),y(a.threadId,!0)):t.url(t.path())}else e.messageAlert.error={title:a.type,message:"Unable to unarchive message thread. "+a.message,show:!0}})},e.archiveThread=function(){e.activeThread&&o.Delete("/threads/"+e.activeThread.threadId,function(i,a){if(i){var s=n.findIndex(e.messageThreads,function(e){return e._id==a._id});s>-1&&(e.messageThreads.splice(s,1),t.url(t.path()))}else e.messageAlert.error={title:a.type,message:"Unable to archive message thread. "+a.message,show:!0}})},e.getMessageImage=function(t){return t.userId==e.account._id?e.account.image:e.activeThread.image},e.getMessages=function(i){if("undefined"!=typeof e.activeThread){if(e.activeThread.newThread)return;if(i){if(e.activeThread.messages.length)return x(e.activeThread),void p.reloadUnreadCount();e.activeThread.refId=void 0}o.Get("/threads/"+e.activeThread.threadId+"/messages"+$(),function(t,a){t?(e.activeThread.messages.push.apply(e.activeThread.messages,a),e.activeThread.refId=a.length?a[a.length-1]._id:void 0,e.activeThread.messageCount=e.activeThread.currentMessageCount,p.reloadUnreadCount(),i&&!e.activeThread.active&&(e.messageAlert.info={title:"Read-Only",message:"Unarchive this conversation to continue sending messages.",show:!0,timeout:5e3})):e.messageAlert.error={title:a.type,message:"Unable to get messages. "+a.message,show:!0}})}else t.url(t.path())};var I=function(t){var i=a.defer();if(t.newThread){var s=n.find(t.users,function(t){return t!=e.account._id});o.Post("/threads",{receivingUser:s},function(a,n){a?(A(n),e.messageThreads.splice(e.messageThreads.indexOf(t),1),e.messageThreads.push(n),i.resolve(n)):i.reject(t)})}else i.resolve();return i.promise};e.sendMessage=function(){e.userMessage&&e.userMessage.length&&(e.lockout=!0,I(e.activeThread).then(function(t){var i=t?t:e.activeThread;o.Post("/threads/"+i.threadId+"/messages",{content:e.userMessage},function(i,a){i?(e.activeThread.messages.push(a),y(a.threadId,"undefined"!=typeof t),e.userMessage=""):e.messageAlert.error={title:a.type,message:"Unable to send message. "+a.message,show:!0},e.lockout=!1})},function(t){e.messageAlert.error={title:t.type,message:"Unable to create thread. "+t.message,show:!0},e.lockout=!1}))},e.activateThread=function(e,i){i?t.url(t.path()+"?threadId="+e.threadId+(e.active?"":"&archived=true")).replace():t.url(t.path()+"?threadId="+e.threadId+(e.active?"":"&archived=true"))},e.loadArchived=function(){o.Get("/threads?archived=true",function(t,i){t?(e.archivedThreads=i,k(e.archivedThreads)):e.messageAlert.error={title:i.type,message:"Unable to load archived message threads. "+i.message,show:!0}})},e.createThread=function(t){var i=n.find(e.messageThreads,function(e){return e.users.indexOf(t)>-1});i?e.activateThread(i,!0):d.getUser(t,function(t,i){if(t){var a={threadId:u.random(9),users:[r.getAccountId(),i._id],newThread:!0,active:!0,threadTag:i.username,modifiedDate:(new Date).toISOString()};A(a),e.messageThreads.push(a),e.activateThread(a,!0)}else e.messageAlert.error={title:i.type,message:"Unable to create thread. "+i.message,show:!0}})};var T=function(){e.$watch(function(){return t.url()},function(i){if(i&&/^\/inbox/.test(i)){if(g=void 0,e.activeThread=void 0,t.search().threadId){if(g=t.search().threadId,t.search().archived)e.archivedThreads.length==[]?e.loadArchived():(e.activeThread=n.findWhere(e.archivedThreads,{threadId:g}),e.getMessages(!0)),e.showArchive=!0;else{if(e.activeThread=n.findWhere(e.messageThreads,{threadId:g}),e.activeThread){var a=e.messageThreads.indexOf(e.activeThread);e.page.threadLimit=Math.max(e.page.threadLimit,a+1),e.showArchive=!1}e.getMessages(!0)}return}if(t.search().userId){var s=p.getAttachments();e.createThread(t.search().userId),s.length&&(e.userMessage="",s.forEach(function(i){e.userMessage+=t.host()+"/"+i.type+"/"+i.id+"\r\n"}))}}})};e.incThreadLimit=function(t,i){e.page.threadLimit=Math.min(e.messageThreads.length,e.page.threadLimit+10)},e.incAThreadLimit=function(t,i){e.page.aThreadLimit=Math.min(e.archivedThreads.length,e.page.aThreadLimit+10)},e.$watch("init",function(e){e===!0&&T()}),angular.element(window).bind("resize",h),e.$on("$destroy",function(){angular.element(window).unbind("resize",h),c.unregisterForNotification("MessageNotification",z)}),c.registerForNotification("MessageNotification",z),h(),o.Get("/threads",function(t,i){t?(e.messageThreads=i,k(e.messageThreads),e.init=!0):e.messageAlert.error={title:i.type,message:"Unable to load message threads. "+i.message,show:!0}})}]).controller("AccountController",["$scope","$location","$window","$timeout","$compile","$ocLazyLoad","AccountService","APIService","FacebookUtils","ImageService","TempStore",function(e,t,i,a,n,s,o,r,c,l,d){if(!o.isLoggedIn()){var u=t.path();return t.path("/login").search("redirect",u)}t.search({}),e.page={active:"account"},e.accountAlert={},e.account=o.getAccount(),e.tempAccount={},e.location={},e.notifications={},e.globalModalOpts={},e.breadcrumbs=[{links:[{text:"My Account"}]}],d.hasKey("seenAccount")?e.skip=!0:d.setTempKey("seenAccount",!0);var p='<div class="image-template"><div class="image-item no-border"><div class="image-entity"><img data-dz-thumbnail /></div><div class="image-progress" data-dz-uploadprogress></div><div class="image-overlay show-always"><div class="image-title handle-overflow"><span data-dz-name></span></div><div class="image-size handle-overflow" data-dz-size></div></div></div></div>',f=function(t){o.putAccountImage(t,function(t,i){t?(e.account=i,e.accountAlert.success={title:"Success",message:"Account profile image updated successfully.",show:!0,timeout:3e3},e.cloneAccount()):e.accountAlert.error={title:"Updated Failed",message:i.type+": "+i.message,show:!0}})};e.deleteAccount=function(){e.globalModalOpts={type:"dz-delete-account-modal",show:!0,data:{account:e.account}}},e.dropzoneConfig={options:{url:"/api/images",method:"POST",thumbnailWidth:150,thumbnailHeight:150,parallelUploads:1,maxFiles:1,paramName:"accountImage",previewTemplate:p,acceptedFiles:"image/*",autoProcessQueue:!1,previewsContainer:"#profile-img",clickable:"#profile-trigger",accept:function(t,i){return null!=this.files[1]?this.removeFile(this.files[1]):t.cropped||t.width<200?(a(function(){e.discImageCropper.cropperLoading=!1,e.page.dropzoneImage=!0}),i()):(a(function(){e.discImageCropper.cropperLoading=!0}),e.dropzoneConfig.getDropzone().removeFile(t),l.getDataUri(t,function(i){e.discImageCropper.showCropper(t.name,i)}),i("Processing"))},success:function(t,i){"undefined"!=typeof i._id?f(i):i.error&&(e.accountAlert.error={title:"Upload Failed",message:"Unable to upload profile picture. Please try again. "+i.error.title+": "+i.error.message,show:!0,timeout:3e3}),this.removeFile(t),e.page.dropzoneImage=!1},queuecomplete:function(){a(function(){e.page.dropzoneProcessing=!1})},removedallfiles:function(){e.page.dropzoneImage=!1}}},e.discImageCropper={onFinish:function(t){e.safeApply(function(){e.discImageCropper.cropperLoading=!1}),t&&e.dropzoneConfig.getDropzone().addFile(t)},cropperLoading:!1},e.triggerDropzone=function(){e.dropzoneConfig.getDropzone().processQueue()},e.clearDropzone=function(){
e.dropzoneConfig.getDropzone().removeAllFiles()},e.deleteAccountImage=function(){o.deleteAccountImage(function(t,i){t?(e.account=i,e.accountAlert.success={title:"Success",message:"Account profile image updated successfully.",show:!0,timeout:3e3},e.cloneAccount()):e.accountAlert.error={title:"Updated Failed",message:i.type+": "+i.message,show:!0}})},e.getJoinDays=function(){return Math.round(Math.abs((new Date(e.account.dateJoined).getTime()-(new Date).getTime())/864e5))},e.countVerifications=function(){var t=0;return e.account.fbId&&t++,e.account.pdgaNumber&&t++,t},e.updateAccount=function(){o.putAccount(e.tempAccount,function(t,i){t?(e.account=i,e.accountAlert.success={title:"Success",message:"Account updated successfully.",show:!0,timeout:3e3},e.cloneAccount()):e.accountAlert.error={title:"Updated Failed",message:i.type+": "+i.message,show:!0}})},e.doFbLink=function(){c.link(function(t,i){t?(e.account=i,e.accountAlert.success={title:"Success",message:"Facebook linked successfully.",show:!0,timeout:3e3}):e.accountAlert.error={title:"Link Failed",message:"Unable to link to Facebook account. "+i.type+": "+i.message,show:!0}})};var g=function(){c.unlink(function(t,i){t?(e.account=i,e.accountAlert.success={title:"Success",message:"Facebook unlinked successfully.",show:!0,timeout:3e3}):e.accountAlert.error={title:"Unlink Failed",message:"Unable to unlink to Facebook account. "+i.type+": "+i.message,show:!0}})};e.warnFbUnlink=function(){e.globalModalOpts={type:"dz-acknowledgement-modal",show:!0,data:{message1:"Do you wish to unlink your Facebook account?",message2:"You will no longer be able to login to disc|zump via Facebook, and your Facebook verification will automatically be disabled if it exists.",onClose:function(e){e&&g()}}}},e.doDelete=function(){o.doAccountDelete(function(e,t){})},e.locSelected=function(t){e.location.curLocation=t.address,e.tempAccount.geoLat=t.latitude,e.tempAccount.geoLng=t.longitude},e.cloneAccount=function(){e.location.search="",e.location.curLocation=e.account.longLocation,e.tempAccount={firstName:e.account.firstName,lastName:e.account.lastName,bio:e.account.bio,geoLat:void 0,geoLng:void 0}},e.cloneAccount(),e.initDropzone=function(){"undefined"==typeof Dropzone||"undefined"==typeof EXIF||"undefined"==typeof Cropper?s.load(["https://cdn.rawgit.com/exif-js/exif-js/master/exif.js","/static/src/js-dist/dropzone.min.js"]).then(function(){s.load(["/static/src/js-dist/cropper.min.js",{type:"css",path:"https://cdn.rawgit.com/fengyuanchen/cropperjs/master/dist/cropper.min.css"}]).then(function(){e.page.dropzoneReady=!0})}):e.page.dropzoneReady=!0},e.getNotifications=function(t){e.page.notificationReady&&!t||(e.page.notificationReady=!1,o.getNotifications(function(t,i){t?e.notifications=i:e.accountAlert.error={title:"Notification Load Failed",message:"Unable to load notifications. "+i.type+": "+i.message,show:!0},e.page.notificationReady=!0}))},e.setNotifications=function(t){e.page.notificationReady=!1,o.putNotifications(e.notifications,function(t,i){t?(e.notifications=i,e.accountAlert.success={title:"Update Successful",message:"Notification settings have been updated successfully.",show:!0,timeout:3e3}):e.accountAlert.error={title:"Update Failed",message:"Unable to save notifications settings. "+i.type+": "+i.message,show:!0},e.page.notificationReady=!0})},e.$watch("page.active",function(t){switch(t){case"profile-pic":return e.initDropzone();case"notification":return e.getNotifications()}}),e.updateTarget=function(i){e.page.active=i,t.url(t.path()+"#"+i)},e.$watch(function(){return location.hash},function(t){var i=t.replace("#","");["account","profile-pic","membership","notification"].indexOf(i)>-1&&(e.skip=!0,e.page.active=i)}),r.Get("/account/count",function(t,i){t&&(e.count=i.count,e.page.ready=!0)})}]).controller("AccountChangeSelController",["$scope","$location","$window","AccountService","APIService","MembershipService","TempStore",function(e,t,i,a,n,s,o){if(!a.isLoggedIn()){var r=t.path();return t.path("/login").search("redirect",r)}t.search({}),e.account=a.getAccount(),e.breadcrumbs=[{links:[{text:"My Account",href:"/account"}]},{links:[{text:"Membership",href:"/account/membership"}]}],e.selUpgrade=function(e){t.path("/account/membership/process").search("key",o.setTemp(e))},e.getAccountType=function(e){return s.getAccountName(e)},e.getAccountCost=function(e){return s.getAccountCost(e)}}]).controller("AccountAdjustController",["$scope","$location","$window","$timeout","smoothScroll","AccountService","APIService","MembershipService","TempStore",function(e,t,i,a,n,s,o,r,c){if(!s.isLoggedIn()){var l=t.path();return t.path("/login").search("redirect",l)}t.search({}),e.account=s.getAccount(),e.breadcrumbs=[{links:[{text:"My Account",href:"/account"}]},{links:[{text:"Membership",href:"/account/membership"}]}],e.billing={},e.paypalConfig={},e.upgradeAlert={},e.form={showBilling:!0},e.showPayment=function(){e.form={showPayment:!0},a(function(){var e=document.getElementById("payment-container"),t={duration:200,easing:"easeInQuad",offset:50};n(e,t)}),e.paypalLoading=!0,r.createHostedPageAdj(e.billing,function(t,i){t?(e.request=i.request,e.paypalConfig.params={src:"https://payflowlink.paypal.com?MODE=TEST&SECURETOKENID="+i.hostedPage.secureTokenId+"&SECURETOKEN="+i.hostedPage.secureToken,width:"490",height:"380",border:"0",frameborder:"0",scrolling:"no",allowtransparency:"true"},e.paypalConfig.create=!0):e.upgradeAlert.error={title:i.type,message:i.message,show:!0},e.paypalLoading=!1})}}]).controller("AccountChangeController",["$scope","$location","$window","$timeout","smoothScroll","AccountService","APIService","MembershipService","TempStore",function(e,t,i,a,n,s,o,r,c){if(!s.isLoggedIn()){var l=t.path();return t.path("/login").search("redirect",l)}return e.account=s.getAccount(),e.breadcrumbs=[{links:[{text:"My Account",href:"/account"}]},{links:[{text:"Membership",href:"/account/membership"}]}],e.form={showConfirm:!0},e.confirm={opAct:!1,paymentMethod:e.account.profile.exists?"useExisting":"createNew"},e.billing={},e.paypalConfig={},e.upgradeAlert={},e.type=c.getTemp(t.search().key),"undefined"==typeof e.type?t.path("/account/membership").replace():(e.accountMethod=r.getChangeType(e.account.profile.type,e.type),e.showBilling=function(){e.form={showBilling:!0},a(function(){var e=document.getElementById("billing-container"),t={duration:200,easing:"easeInQuad",offset:50};n(e,t)})},e.showPayment=function(){e.form={showPayment:!0};var t=document.getElementById("payment-container"),i={duration:200,easing:"easeInQuad",offset:50};n(t,i),e.paypalLoading=!0,r.createHostedPage(e.type,e.billing,function(t,i){t?(console.log(i),e.request=i.request,e.paypalConfig.params={src:"https://payflowlink.paypal.com?MODE=TEST&SECURETOKENID="+i.hostedPage.secureTokenId+"&SECURETOKEN="+i.hostedPage.secureToken,width:"490",height:"250",border:"0",frameborder:"0",scrolling:"no",allowtransparency:"true"},e.paypalConfig.create=!0):e.upgradeAlert.error={title:i.type,message:i.message,show:!0},e.paypalLoading=!1})},e.confirmChange=function(){"upgrade-profile"==e.accountMethod||"downgrade-profile"==e.accountMethod?(e.confirmLoading=!0,r.modifyExisting(e.type,function(i,a){i?t.url("/account/membership/result?req="+a.req):t.url("/account/membership/result?err_type="+a.type+"&err_msg="+a.message),e.confirmLoading=!1})):"clear-profile"==e.accountMethod?(e.confirmLoading=!0,r.clearExisting(function(i,a){i?t.url("/account/membership/result?req="+a.req):t.url("/account/membership/result?err_type="+a.type+"&err_msg="+a.message),e.confirmLoading=!1})):"no-profile"==e.accountMethod&&e.account.profile.exists&&(e.confirmLoading=!0,r.reactivate(e.type,function(i,a){i?t.url("/account/membership/result?req="+a.req):t.url("/account/membership/result?err_type="+a.type+"&err_msg="+a.message),e.confirmLoading=!1}))},"undefined"==typeof e.accountMethod?t.path("/account/change").replace():(e.getAccountType=function(e){return r.getAccountName(e)},void(e.getAccountCost=function(e){return r.getAccountCost(e)})))}]).controller("AccountChangeResultController",["$scope","$location","$window","$timeout","AccountService","APIService","MembershipService","TempStore",function(e,t,i,a,n,s,o,r){if(!n.isLoggedIn()){var c=t.path();return t.path("/login").search("redirect",c)}e.breadcrumbs=[{links:[{text:"My Account",href:"/account"}]},{links:[{text:"Membership",href:"/account/membership"}]}],e.loading=!0,e.error={message:t.search().err_msg,type:t.search().err_type},e.getAccountType=function(e){return o.getAccountName(e)},e.getAccountCost=function(e){return o.getAccountCost(e)},n.getAccount(function(i,a){return i?(e.account=a,e.accountType=a.profile?a.profile.type:a.accountType,e.pending=e.accountType!=a.accountType,t.search().req?s.GetExt("/membership","/request/"+t.search().req,function(t,i){t?(e.request=i,i.error&&(e.error=i.error)):e.error=i,e.loading=!1}):e.loading=!1,void 0):t.path("/account/change").replace()})}]).controller("VerificationsController",["$scope","$location","AccountService","APIService","VerificationService",function(e,t,i,a,n){if(!i.isLoggedIn()){var s=t.path();return t.path("/login").search("redirect",s)}t.search({}),e.account=i.getAccount(),e.pdga={toggle:!0,alert:{}},e.fb={toggle:!0,alert:{},active:"undefined"!=typeof e.account.fbId},e.breadcrumbs=[{links:[{text:"My Account",href:"/account"}]},{links:[{text:"Verifications"}]}],e.$watch("fb.active",function(t){e.fb.pristine=t===("undefined"!=typeof e.account.fbId)}),e.setFBVerification=function(){i.putVerifications({facebook:e.fb.active},function(t,i){if(t){e.account=i;var a=i.fbId?"made public.":"hidden from the public.";e.fb.alert.success={title:"Success",message:"Your Facebook account has been "+a,show:!0}}else e.fb.alert.error={title:i.type,message:i.message,show:!0}})},e.resetPDGA=function(){e.pdga.alert={},e.pdga.loading=!0,i.resetPDGA(function(t,i){t?(e.account=i,e.pdga.alert.success={title:"Success",message:"Your PDGA Number has been reset.",show:!0}):e.pdga.alert.error={title:i.type,message:i.message,show:!0},e.pdga.loading=!1})},e.verifyPDGA=function(){e.pdga.alert={},e.pdga.loading=!0,i.verifyPDGA(e.pdga.username,e.pdga.password,function(t,i){t?(e.account=i,e.pdga.alert.success={title:"Success",message:"Your PDGA Number has been verified as (#"+e.account.pdgaNumber+").",show:!0}):e.pdga.alert.error={title:i.type,message:i.message,show:!0},e.pdga.loading=!1})}}]).controller("LoginController",["$scope","$location","$window","AccountService","APIService","FacebookUtils",function(e,t,i,a,n,s){var o=t.search().redirect;return a.isLoggedIn()?t.path("/account"):(e.loading=!1,e.cred={username:"",password:""},e.loginAlert={},e.doFbLogin=function(){s.login(function(i,a){return i?"undefined"!=typeof o?t.path(o).search({}):t.path("/explore").search({}):void(a&&("Inactive"==a.type&&(a.message={smartConfig:{text:a.message+" To resend a confirmation email, <!click here>.",links:["/confirm"]}}),e.loginAlert.error={title:a.type,message:a.message,show:!0}))})},void(e.doLogin=function(){e.loading=!0,e.loginAlert={},a.doLogin(e.cred.username,e.cred.password,function(i,a){return i?"undefined"!=typeof o?t.path(o).search({}):t.path("/explore").search({}):(e.loading=!1,void(a&&(e.loginAlert.error={title:a.type,message:a.message,show:!0})))})}))}]).controller("SignupController",["$scope","$location","$window","$timeout","AccountService","APIService","LocalStorage","LocationService","FacebookUtils",function(e,t,i,a,n,s,o,r,c){if(n.isLoggedIn())return t.path("/account").replace();if(!o.itemExists("dz-signup"))return o.addItem("dz-signup",!0),t.path("/about").replace();var l={userLength:/^.{6,15}$/,userChars:/^[a-zA-Z0-9\_]+$/,pwLength:/^.{6,}$/};e.loading=!1,e.signup={},e.signupAlert={},e.location={results:[],loading:!1,locSet:!1,geo:{}},e.locSelected=function(t){e.location.curLocation=t.address,e.location.geo={latitude:t.latitude,longitude:t.longitude}},e.getFBAccount=function(){c.getFBAccount(function(t,i){t?s.Post("/validate/facebook",{userID:i.token.userID},function(t,n){t?n._id?e.signupAlert.error={title:"Validation Error",message:"The Facebook account is already associated with another user.",show:!0}:a(function(){e.signup.firstName=i.account.first_name,e.signup.form.firstName.$setDirty(),e.signup.lastName=i.account.last_name,e.signup.form.lastName.$setDirty(),e.signup.email=i.account.email,e.signup.form.email.$setDirty(),e.facebook={userID:i.token.userID,accessToken:i.token.accessToken}}):e.signupAlert.error={title:"Validation Error",message:"Unable to validate Facebook credentials. Please try again.",show:!0}}):console.log("no success")})},e.matchFormat=function(t,i){return!!e.signup[t]&&(!!l[i]&&l[i].test(e.signup[t]))},e.doSignUp=function(){e.loading=!0,e.signupAlert={},s.Post("/users",{username:e.signup.username,email:e.signup.email,firstName:e.signup.firstName,lastName:e.signup.lastName,password:e.signup.password,geoLat:e.location.geo.latitude,geoLng:e.location.geo.longitude,facebook:e.facebook},function(t,i){e.loading=!1,t?(e.signupAlert.success={title:"Signup Successful",message:"A confirmation email has been sent to "+i.email+".",show:!0},e.signupComplete=!0):e.signupAlert.error={title:i.type,message:i.message,show:!0}})}}]).controller("TrunkLookupController",["$scope","$location","RedirectService","$routeParams","CacheService",function(e,t,i,a,n){t.search({}),n.getUser(a.userId,function(e,t){e?i.setRedirect("t/"+t.username):i.setRedirect()})}]).controller("ConfirmController",["$scope","$location","$timeout","$routeParams","AccountService",function(e,t,i,a,n){return n.isLoggedIn()?t.path("/account").search({}):(t.search({}),e.confirmAlert={},e.loading=!0,e.confirmAlert.error={},void n.doAccountConfirm(a.authorizationId,function(i,a){return i?t.path("/explore").replace():(e.loading=!1,void(a&&(e.confirmAlert.error={title:a.type,message:a.message,show:!0})))}))}]).controller("DeleteController",["$scope","$location","$timeout","$routeParams","AccountService",function(e,t,i,a,n){if(!n.isLoggedIn()){var s=t.path();return t.path("/login").search("redirect",s)}t.search({}),e.deleteAlert={},e.loading=!0,e.deleteSuccess=!1,e.deleteAlert.error={},n.doAccountDeleteConfirm(a.authorizationId,function(t,i){e.loading=!1,e.deleteSuccess=t,t||(e.deleteAlert.error={title:i.type,message:i.message,show:!0})})}]).controller("RecoverController",["$scope","$location","$timeout","$routeParams","AccountService","APIService",function(e,t,i,a,n,s){return n.isLoggedIn()?t.path("/account").replace():(t.search({}),e.recoverAlert={},e.cred={},e.loading=!1,void(e.doRecover=function(){e.loading=!0,s.Post("/account/recover",{email:e.cred.username},function(t,i){e.loading=!1,t?e.recoverAlert.success={title:"Success",message:"A confirmation email has been sent the above email address with instructions on how to recover your account.",show:!0}:e.recoverAlert.error={title:i.type,message:i.message,show:!0}})}))}]).controller("ConfirmInitController",["$scope","$location","$timeout","$routeParams","AccountService","APIService",function(e,t,i,a,n,s){return n.isLoggedIn()?t.path("/account").replace():(t.search({}),e.confirmAlert={},e.cred={},e.loading=!1,void(e.doConfirmInit=function(){e.loading=!0,s.Post("/account/confirm",{email:e.cred.username},function(t,i){e.loading=!1,t?e.confirmAlert.success={title:"Success",message:"A confirmation email has been sent the above email address with instructions on how to activate your account.",show:!0}:e.confirmAlert.error={title:i.type,message:i.message,show:!0}})}))}]).controller("UnsubscribeController",["$scope","$location","$timeout","$routeParams","APIService",function(e,t,i,a,n){e.subscribeAlert={},e.loading=!0,e.success=!1,a.hashId&&a.type?n.Post("/account/unsubscribe",{hashId:a.hashId,notification:a.type},function(t,i){t?(e.loading=!1,e.success=!0):(e.subscribeAlert.error={title:i.type,message:i.message,show:!0},e.loading=!1)}):(e.subscribeAlert.error={title:"Invalid Request",message:"Please try again.",show:!0},e.loading=!1)}]).controller("ResetController",["$scope","$location","$timeout","$routeParams","AccountService","APIService",function(e,t,i,a,n,s){return e.isReset="undefined"==typeof a.authorizationId,t.search({}),!e.isReset&&n.isLoggedIn()||e.isReset&&!n.isLoggedIn()?t.path("/redirect"):(e.isReset&&(e.breadcrumbs=[{links:[{text:"My Account",href:"/account"}]},{links:[{text:"Reset Password"}]}]),e.resetAlert={},e.cred={},e.loading=!1,e.validating=!0,e.isValid=!1,e.matchLen=function(e){return e&&/^.{6,}$/.test(e)},e.doReset=function(){e.resetAlert={},e.isReset?s.Post("/account/reset",{currentPw:e.cred.cpassword,newPw:e.cred.password},function(t,i){t?(e.cred={},e.resetAlert.success={title:"Password Reset",message:"Your password has been reset successfully.",show:!0}):e.resetAlert.error={title:i.type,message:i.message,show:!0}}):s.Post("/account/recover/"+a.authorizationId,{password:e.cred.password},function(t,i){t?(e.cred={},e.resetAlert.success={title:"Password Reset",message:"Your password has been reset successfully. Please login to continue.",show:!0}):e.resetAlert.error={title:i.type,message:i.message,show:!0}})},void(e.isReset?(e.validating=!1,e.isValid=!0):s.Get("/account/recover/"+a.authorizationId,function(t,i){return e.validating=!1,t?void(e.isValid=!0):e.resetAlert.error={title:i.type,message:i.message,show:!0}})))}]).controller("AboutController",["$scope","$location","$compile","$timeout","AccountService","MembershipService",function(e,t,i,a,n,s){e.account=n.getAccount(),t.search({}),e.hiwImage="/static/img/anim/upload.mp4",e.getAccountType=function(e){return s.getAccountName(e)},e.getAccountCost=function(e){return s.getAccountCost(e)}}]).controller("FAQController",["$scope","$location","$timeout","smoothScroll","PageUtils",function(e,t,i,a,n){var s=function(t){var i=document.getElementById(t);i&&(e.activeTarget=t,(n.getTop(i)<n.getScrollPos()||n.getFullHeight(i)>n.getScrollPos()+n.getWindowHeight())&&a(i,{duration:300,easing:"easeInQuad",offset:60}))};e.updateUrl=function(e){location.hash==="#"+e?s("faq-"+e):t.url(t.path()+"#"+e)},e.$watch(function(){return location.hash},function(e){"undefined"!==e&&s("faq-"+e.replace("#",""))})}]).controller("LogoutController",["$location","$timeout","AccountService",function(e,t,i){var a=e.search();return i.isLoggedIn()?void t(function(){i.doLogout(function(){a.redirectURI?e.path("/"+a.redirectURI).replace():e.path("/login").replace()})},500):e.path("/login").replace()}]);